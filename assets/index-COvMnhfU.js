import{s as v,j as e,h as C}from"./index-ByRmShh_.js";import{b as c}from"./vendor-C_ovgAfI.js";import{c as z,f as M}from"./utils-CWHH1IbV.js";import{M as $}from"./index-CfemnTlo.js";import{z as B}from"./zh-CN-CCt-M6vz.js";const U=z(t=>({list:[],fetchBookmarks:async()=>{const{data:s,error:r}=await v.from("bookmark").select("*").order("create_at",{ascending:!1});if(r){console.error("Failed to fetch bookmark data:",r);return}t({list:s})}})),H=async t=>{var s,r,n,o;try{const d="https://api.allorigins.win/get?url="+encodeURIComponent(t),l=await(await fetch(d)).json();if(!l.contents)throw new Error("æ— æ³•èŽ·å–ç½‘ç«™å†…å®¹");const p=new DOMParser().parseFromString(l.contents,"text/html");let a=((s=p.querySelector("title"))==null?void 0:s.textContent)||"";a||(a=((r=p.querySelector('meta[property="og:title"]'))==null?void 0:r.getAttribute("content"))||"");let i="";const h=p.querySelector('link[rel="icon"]')||p.querySelector('link[rel="shortcut icon"]');h&&(i=new URL(h.getAttribute("href"),t).href),i||(i=`https://www.google.com/s2/favicons?domain=${t}`);let x=((n=p.querySelector('meta[name="keywords"]'))==null?void 0:n.getAttribute("content"))||"",y=((o=p.querySelector('meta[name="description"]'))==null?void 0:o.getAttribute("content"))||"",N=O(x+" "+y)||R(new URL(t).hostname);return{title:a||A(t),icon:i,suggestedCategory:N}}catch(d){return console.error("èŽ·å–ç½‘ç«™ä¿¡æ¯å¤±è´¥:",d),D(t)}},O=(t="")=>{const s=t.toLowerCase(),r={æŠ€æœ¯:["programming","developer","coding","ç¼–ç¨‹","å¼€å‘","æŠ€æœ¯"],æ–°é—»:["news","daily","report","æ–°é—»","èµ„è®¯"],è´­ç‰©:["shop","store","buy","price","å•†åŸŽ","è´­ç‰©"],æ•™è‚²:["learn","course","education","study","æ•™è‚²","å­¦ä¹ "],å¨±ä¹:["game","entertainment","movie","music","æ¸¸æˆ","ç”µå½±","éŸ³ä¹"],ç¤¾äº¤:["social","community","forum","ç¤¾åŒº","è®ºå›"]};for(const[n,o]of Object.entries(r))if(o.some(d=>s.includes(d)))return n;return null},A=t=>{try{const s=new URL(t).hostname;return s.split(".")[0].charAt(0).toUpperCase()+s.split(".")[0].slice(1)}catch{return t}},D=t=>{try{const s=new URL(t).hostname;return{title:A(t),icon:`https://www.google.com/s2/favicons?domain=${t}`,suggestedCategory:R(s)}}catch{throw new Error("æ— æ•ˆçš„URLæ ¼å¼")}},R=t=>{const s={github:"å¼€å‘å·¥å…·",stackoverflow:"å¼€å‘å·¥å…·",youtube:"è§†é¢‘",bilibili:"è§†é¢‘",google:"æœç´¢",baidu:"æœç´¢",zhihu:"ç¤¾äº¤",weibo:"ç¤¾äº¤",twitter:"ç¤¾äº¤",facebook:"ç¤¾äº¤",instagram:"ç¤¾äº¤",amazon:"è´­ç‰©",taobao:"è´­ç‰©",jd:"è´­ç‰©"};for(const[r,n]of Object.entries(s))if(t.includes(r))return n;return"å…¶ä»–"},_=(t,s)=>{const r=t.toLowerCase().replace(/\/$/,"");return s.some(n=>n.url.toLowerCase().replace(/\/$/,"")===r)};function F({formData:t,setFormData:s,categories:r,onSubmit:n,onCancel:o}){const[d,g]=c.useState(!1),[l,f]=c.useState(!1);c.useEffect(()=>{const a=i=>{d&&!i.target.closest(".category-select-container")&&g(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[d]);const p=async a=>{if(a.preventDefault(),!l){f(!0);try{await n(t)}catch{throw new Error("æ·»åŠ ä¹¦ç­¾å¤±è´¥")}finally{f(!1)}}};return e.jsxs("form",{onSubmit:p,className:"bookmark-form",children:[e.jsx("h3",{children:"ä¹¦ç­¾ä¿¡æ¯"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:t.name,onChange:a=>s(i=>({...i,name:a.target.value})),placeholder:"ä¹¦ç­¾åç§°",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:t.category,onChange:a=>s(i=>({...i,category:a.target.value})),onFocus:()=>g(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»",required:!0}),d&&r.length>0&&e.jsx("div",{className:"category-dropdown",children:r.map((a,i)=>e.jsx("div",{className:`category-option ${t.category===a?"selected":""}`,onClick:()=>{s(h=>({...h,category:a})),g(!1)},children:a},i))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-input-container",children:[e.jsx("input",{type:"text",value:t.icon,onChange:a=>s(i=>({...i,icon:a.target.value})),placeholder:"å›¾æ ‡URL"}),t.icon&&e.jsx("div",{className:"icon-preview",children:e.jsx("img",{src:t.icon,alt:"ç½‘ç«™å›¾æ ‡",onError:a=>a.target.src="/fallback-icon.svg"})})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:o,disabled:l,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:`submit-button ${l?"loading":""}`,disabled:l,children:l?"æ·»åŠ ä¸­...":"æ·»åŠ ä¹¦ç­¾"})]})]})}function I({analyzing:t,analysisStep:s,analysisError:r,urlExists:n}){const o=["å¼€å§‹åˆ†æž","éªŒè¯URLæ ¼å¼","èŽ·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æžç»“æžœ","åˆ†æžå®Œæˆ"];return e.jsxs(e.Fragment,{children:[t&&e.jsxs("div",{className:"analysis-status",children:[e.jsx("h3",{children:"æ­£åœ¨åˆ†æžç½‘ç«™..."}),e.jsx("div",{className:"analysis-steps",children:o.map((d,g)=>e.jsxs("div",{className:`analysis-step ${s===d?"active":""} ${o.indexOf(d)<o.indexOf(s)?"complete":""}`,children:[e.jsx("div",{className:"step-indicator",children:g+1}),e.jsx("div",{className:"step-label",children:d})]},g))})]}),n&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:"è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­"}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šæ‚¨å¯ä»¥åœ¨ä¹¦ç­¾åˆ—è¡¨ä¸­æŸ¥æ‰¾æ­¤ç½‘ç«™ã€‚"})]}),r&&!n&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:r}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç¨åŽå†è¯•ã€‚"})]})]})}function T({onClose:t,onSubmit:s}){const{list:r}=U(),[n,o]=c.useState(""),[d,g]=c.useState({url:"",name:"",category:"",icon:""}),[l,f]=c.useState(!1),[p,a]=c.useState(null),[i,h]=c.useState(null),[x,y]=c.useState(!1),[N,u]=c.useState([]),[w,S]=c.useState(!1);c.useEffect(()=>{if(r&&r.length>0){const j=[...new Set(r.map(k=>k.category).filter(Boolean))];u(j)}},[r]);const m=async()=>{if(!(!n||!n.trim())){f(!0),a("å¼€å§‹åˆ†æž"),h(null),y(!1),S(!1);try{a("éªŒè¯URLæ ¼å¼");let j=n;!n.startsWith("http://")&&!n.startsWith("https://")&&(j="https://"+n);const k=j.toLowerCase().replace(/\/$/,"");if(_(k,r)){S(!0),h("è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­"),f(!1);return}a("èŽ·å–ç½‘ç«™å…ƒæ•°æ®");const E=await H(j);a("å¤„ç†åˆ†æžç»“æžœ"),g({url:j,name:E.title||"",icon:E.icon||"",category:E.suggestedCategory||""}),a("åˆ†æžå®Œæˆ"),y(!0)}catch(j){h(`åœ¨"${p}"æ­¥éª¤å¤±è´¥: ${j.message}`)}finally{f(!1)}}},b=async j=>{try{const k=j.url.toLowerCase().replace(/\/$/,"");if(_(k,r)){S(!0),h("è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­");return}await s(j),t()}catch(k){console.error("æ·»åŠ ä¹¦ç­¾å¤±è´¥:",k),h("æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·é‡è¯•")}};return e.jsx($,{isOpen:!0,onClose:t,title:"æ·»åŠ æ–°ä¹¦ç­¾",size:"md",position:"center",children:e.jsxs("div",{className:"bookmark-modal-content",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ç½‘å€"}),e.jsxs("div",{className:"url-input-container",children:[e.jsx("input",{type:"url",value:n,onChange:j=>o(j.target.value),placeholder:"è¾“å…¥ç½‘ç«™åœ°å€",required:!0}),e.jsx("button",{type:"button",className:`analyze-button ${l?"loading":""}`,onClick:m,disabled:l||!n,children:l?"åˆ†æžä¸­...":"åˆ†æž"})]})]}),e.jsx(I,{analyzing:l,analysisStep:p,analysisError:i,urlExists:w}),x&&e.jsx(F,{formData:d,setFormData:g,categories:N,onSubmit:b,onCancel:t})]})})}function W({bookmark:t,onClose:s,onSubmit:r}){const{list:n}=U(),[o,d]=c.useState({name:t.name,category:t.category,icon:t.icon}),[g,l]=c.useState([]),[f,p]=c.useState(!1),[a,i]=c.useState(!1),[h,x]=c.useState(!1),y=c.useRef({name:t.name,category:t.category,icon:t.icon}).current;c.useEffect(()=>{const u=o.name!==y.name||o.category!==y.category||o.icon!==y.icon;x(u)},[o,y]),c.useEffect(()=>{if(n&&n.length>0){const u=[...new Set(n.map(w=>w.category).filter(Boolean))];l(u)}},[n]),c.useEffect(()=>{const u=w=>{f&&!w.target.closest(".category-select-container")&&p(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[f]);const N=async u=>{if(u.preventDefault(),!(!h||a)){i(!0);try{await r({...t,...o}),s()}catch(w){console.error("ä¿å­˜ä¹¦ç­¾å¤±è´¥:",w)}finally{i(!1)}}};return e.jsx($,{isOpen:!0,onClose:s,title:"ç¼–è¾‘ä¹¦ç­¾",size:"md",position:"center",children:e.jsx("div",{className:"bookmark-modal-content",children:e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:o.name,onChange:u=>d({...o,name:u.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-input-container",children:[e.jsx("input",{type:"text",value:o.icon,onChange:u=>d({...o,icon:u.target.value}),placeholder:"è¾“å…¥å›¾æ ‡ URL"}),o.icon&&e.jsx("div",{className:"icon-preview",children:e.jsx("img",{src:o.icon,alt:"å›¾æ ‡é¢„è§ˆ",onError:u=>u.target.src="/fallback-icon.svg"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:o.category,onChange:u=>d({...o,category:u.target.value}),onFocus:()=>p(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»"}),f&&g.length>0&&e.jsx("div",{className:"category-dropdown",children:g.map(u=>e.jsx("div",{className:`category-option ${u===o.category?"selected":""}`,onClick:()=>{d({...o,category:u}),p(!1)},children:u},u))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:s,disabled:a,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:`submit-button ${a?"loading":""}`,disabled:!h||a,children:a?"ä¿å­˜ä¸­...":"ä¿å­˜ä¿®æ”¹"})]})]})})})}function P({message:t,type:s="success",onClose:r,duration:n=3e3}){return c.useEffect(()=>{const o=setTimeout(()=>{r()},n);return()=>clearTimeout(o)},[n,r]),e.jsxs("div",{className:`notification notification-${s}`,children:[e.jsx("span",{className:"notification-icon",children:s==="success"?"âœ“":"âœ•"}),e.jsx("span",{className:"notification-message",children:t})]})}function G({onRestore:t,onNotify:s}){const[r,n]=c.useState([]),[o,d]=c.useState(!1),[g,l]=c.useState(new Set),f=async()=>{d(!0);try{const{data:a}=await v.from("bookmark_history").select("restored_from_id").not("restored_from_id","is",null),i=new Set((a==null?void 0:a.map(y=>y.restored_from_id))||[]);l(i);const{data:h,error:x}=await v.from("bookmark_history").select("*").order("created_at",{ascending:!1});if(x)throw x;n(h)}catch(a){console.error("èŽ·å–åŽ†å²è®°å½•å¤±è´¥:",a),s==null||s({type:"error",message:"èŽ·å–åŽ†å²è®°å½•å¤±è´¥"})}finally{d(!1)}};c.useEffect(()=>{f()},[]);const p=async a=>{try{const{bookmark_data:i}=a,{error:h}=await v.from("bookmark").insert([i]);if(h)throw h;const{error:x}=await v.from("bookmark_history").insert([{action:"restore",bookmark_id:i.id,bookmark_data:i,restored_from_id:a.id}]);if(x)throw x;s==null||s({type:"success",message:"ä¹¦ç­¾æ¢å¤æˆåŠŸ"}),t==null||t(),f()}catch(i){console.error("æ¢å¤ä¹¦ç­¾å¤±è´¥:",i),s==null||s({type:"error",message:"æ¢å¤ä¹¦ç­¾å¤±è´¥"})}};return e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"æ“ä½œåŽ†å²"}),e.jsx("span",{className:"history-count",children:o?"åŠ è½½ä¸­...":`${r.length} æ¡è®°å½•`})]}),o?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½åŽ†å²è®°å½•..."})]}):e.jsx("div",{className:"history-list",children:r.map(a=>e.jsxs("div",{className:"history-item",children:[e.jsxs("div",{className:"history-content",children:[e.jsxs("span",{className:"history-action",children:[a.action==="add"&&"æ·»åŠ äº†",a.action==="delete"&&"åˆ é™¤äº†",a.action==="update"&&"ä¿®æ”¹äº†",a.action==="restore"&&"æ¢å¤äº†"]}),e.jsx("span",{className:"history-name",children:a.bookmark_data.name}),e.jsx("span",{className:"history-time",children:M(new Date(a.created_at),{addSuffix:!0,locale:B})})]}),a.action==="delete"&&!g.has(a.id)&&e.jsx("button",{className:"restore-button",onClick:()=>p(a),children:"æ¢å¤"})]},a.id))})]})}const L={async fetchAll(){try{const{data:t,error:s}=await v.from("bookmark").select("*").order("create_at",{ascending:!1});if(s)throw s;return t}catch(t){throw new Error(C(t))}},async create(t){try{const s=Date.now()+Math.floor(Math.random()*1e3),r={...t,id:s,create_at:new Date().toISOString()},{data:n,error:o}=await v.from("bookmark").insert([r]).select();if(o)throw o;return await this.recordHistory("add",r),n[0]}catch(s){throw new Error(C(s))}},async update(t){try{const{data:s,error:r}=await v.from("bookmark").update({name:t.name,category:t.category,icon:t.icon}).eq("url",t.url).select();if(r)throw r;return await this.recordHistory("update",t),s[0]}catch(s){throw new Error(C(s))}},async delete(t){try{const{data:s,error:r}=await v.from("bookmark").delete().eq("url",t.url).select();if(r)throw r;return await this.recordHistory("delete",t),s}catch(s){throw new Error(C(s))}},async recordHistory(t,s){try{const{error:r}=await v.from("bookmark_history").insert([{action:t,bookmark_id:s.id,bookmark_data:s}]);if(r)throw r}catch(r){console.error("è®°å½•åŽ†å²å¤±è´¥:",r)}}};function Y(){const[t,s]=c.useState(!0),{list:r,fetchBookmarks:n}=U();c.useEffect(()=>{(async()=>{s(!0),await n(),s(!1)})()},[]);const[o,d]=c.useState(!1),[g,l]=c.useState(null),f=m=>{navigator.clipboard.writeText(m).then(()=>{l({type:"success",message:"URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿"})}).catch(()=>{l({type:"error",message:"å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶"})})},p=async m=>{try{await L.create(m),l({type:"success",message:"æˆåŠŸæ·»åŠ ä¹¦ç­¾"}),n()}catch(b){console.log(b),l({type:"error",message:"æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"})}},a=async m=>{try{await L.delete(m),l({type:"success",message:"æˆåŠŸåˆ é™¤ä¹¦ç­¾"}),n()}catch(b){console.error(b),l({type:"error",message:"åˆ é™¤ä¹¦ç­¾å¤±è´¥"})}},[i,h]=c.useState(!1),[x,y]=c.useState(null),N=m=>{y(m),h(!0)},u=async m=>{try{await L.update(m),l({type:"success",message:"æˆåŠŸæ›´æ–°ä¹¦ç­¾"}),n()}catch(b){console.error(b),l({type:"error",message:"æ›´æ–°ä¹¦ç­¾å¤±è´¥"})}h(!1),y(null)},[w,S]=c.useState(!1);return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:`tab-button ${w?"":"active"}`,onClick:()=>S(!1),children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsx("button",{className:`tab-button ${w?"active":""}`,onClick:()=>S(!0),children:"æ“ä½œåŽ†å²"})]}),e.jsx("div",{className:"dashboard-content",children:w?e.jsx(G,{onRestore:n,onNotify:l}):e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"add-button",onClick:()=>d(!0),children:[e.jsx("span",{className:"button-icon",children:"+"}),"æ·»åŠ ä¹¦ç­¾"]}),e.jsx("span",{className:"bookmark-count",children:t?"åŠ è½½ä¸­...":`${r.length} ä¸ªä¹¦ç­¾`})]})]}),t?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½ä¹¦ç­¾..."})]}):e.jsx("div",{className:"bookmark-list",children:r.map(m=>e.jsxs("div",{className:"bookmark-item",children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{"data-name":m.name,"data-category":m.category,src:m.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:b=>{b.target.src="/fallback-icon.svg"}})}),e.jsxs("div",{className:"bookmark-info",children:[e.jsx("h3",{children:m.name}),e.jsx("p",{className:"category-tag",children:m.category}),e.jsxs("div",{className:"url-container",children:[e.jsx("a",{href:m.url,target:"_blank",rel:"noopener noreferrer",children:m.url}),e.jsx("button",{className:"copy-button",onClick:b=>{b.preventDefault(),f(m.url)},title:"å¤åˆ¶URL",children:"ðŸ“‹"})]})]}),e.jsxs("div",{className:"bookmark-actions",children:[e.jsx("button",{className:"edit-button",onClick:()=>N(m),title:"ç¼–è¾‘ä¹¦ç­¾",children:"âœï¸"}),e.jsx("button",{className:"delete-button",onClick:()=>a(m),title:"åˆ é™¤ä¹¦ç­¾",children:e.jsx("span",{className:"delete-icon",children:"Ã—"})})]})]},m.url))})]})}),o&&e.jsx(T,{onClose:()=>d(!1),onSubmit:p}),i&&x&&e.jsx(W,{bookmark:x,onClose:()=>{h(!1),y(null)},onSubmit:u}),g&&e.jsx(P,{type:g.type,message:g.message,onClose:()=>l(null)})]})}export{Y as default};
