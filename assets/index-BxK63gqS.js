import{s as b,j as e}from"./index-DH5OR8F1.js";import{b as u}from"./vendor-C_ovgAfI.js";import{c as R,f as z}from"./utils-CWHH1IbV.js";import{M as _}from"./index-BF6PIHGi.js";import{z as A}from"./zh-CN-CCt-M6vz.js";const E=R(s=>({list:[],fetchBookmarks:async()=>{const{data:t,error:o}=await b.from("bookmark").select("*").order("create_at",{ascending:!1});if(o){console.error("Failed to fetch bookmark data:",o);return}s({list:t})}})),M=async s=>{var t,o,a,i;try{const h="https://api.allorigins.win/get?url="+encodeURIComponent(s),p=await(await fetch(h)).json();if(!p.contents)throw new Error("æ— æ³•èŽ·å–ç½‘ç«™å†…å®¹");const m=new DOMParser().parseFromString(p.contents,"text/html");let n=((t=m.querySelector("title"))==null?void 0:t.textContent)||"";n||(n=((o=m.querySelector('meta[property="og:title"]'))==null?void 0:o.getAttribute("content"))||"");let r="";const g=m.querySelector('link[rel="icon"]')||m.querySelector('link[rel="shortcut icon"]');g&&(r=new URL(g.getAttribute("href"),s).href),r||(r=`https://www.google.com/s2/favicons?domain=${s}`);let f=((a=m.querySelector('meta[name="keywords"]'))==null?void 0:a.getAttribute("content"))||"",j=((i=m.querySelector('meta[name="description"]'))==null?void 0:i.getAttribute("content"))||"",w=O(f+" "+j)||q(new URL(s).hostname);return{title:n||$(s),icon:r,suggestedCategory:w}}catch(h){return console.error("èŽ·å–ç½‘ç«™ä¿¡æ¯å¤±è´¥:",h),B(s)}},O=(s="")=>{const t=s.toLowerCase(),o={æŠ€æœ¯:["programming","developer","coding","ç¼–ç¨‹","å¼€å‘","æŠ€æœ¯"],æ–°é—»:["news","daily","report","æ–°é—»","èµ„è®¯"],è´­ç‰©:["shop","store","buy","price","å•†åŸŽ","è´­ç‰©"],æ•™è‚²:["learn","course","education","study","æ•™è‚²","å­¦ä¹ "],å¨±ä¹:["game","entertainment","movie","music","æ¸¸æˆ","ç”µå½±","éŸ³ä¹"],ç¤¾äº¤:["social","community","forum","ç¤¾åŒº","è®ºå›"]};for(const[a,i]of Object.entries(o))if(i.some(h=>t.includes(h)))return a;return null},$=s=>{try{const t=new URL(s).hostname;return t.split(".")[0].charAt(0).toUpperCase()+t.split(".")[0].slice(1)}catch{return s}},B=s=>{try{const t=new URL(s).hostname;return{title:$(s),icon:`https://www.google.com/s2/favicons?domain=${s}`,suggestedCategory:q(t)}}catch{throw new Error("æ— æ•ˆçš„URLæ ¼å¼")}},q=s=>{const t={github:"å¼€å‘å·¥å…·",stackoverflow:"å¼€å‘å·¥å…·",youtube:"è§†é¢‘",bilibili:"è§†é¢‘",google:"æœç´¢",baidu:"æœç´¢",zhihu:"ç¤¾äº¤",weibo:"ç¤¾äº¤",twitter:"ç¤¾äº¤",facebook:"ç¤¾äº¤",instagram:"ç¤¾äº¤",amazon:"è´­ç‰©",taobao:"è´­ç‰©",jd:"è´­ç‰©"};for(const[o,a]of Object.entries(t))if(s.includes(o))return a;return"å…¶ä»–"},U=(s,t)=>{const o=s.toLowerCase().replace(/\/$/,"");return t.some(a=>a.url.toLowerCase().replace(/\/$/,"")===o)};function D({formData:s,setFormData:t,categories:o,onSubmit:a,onCancel:i}){const[h,x]=u.useState(!1);u.useEffect(()=>{const d=m=>{h&&!m.target.closest(".category-select-container")&&x(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[h]);const p=d=>{d.preventDefault(),a(s)};return e.jsxs("form",{onSubmit:p,className:"bookmark-form",children:[e.jsx("h3",{children:"ä¹¦ç­¾ä¿¡æ¯"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:s.name,onChange:d=>t(m=>({...m,name:d.target.value})),placeholder:"ä¹¦ç­¾åç§°",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:s.category,onChange:d=>t(m=>({...m,category:d.target.value})),onFocus:()=>x(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»",required:!0}),h&&o.length>0&&e.jsx("div",{className:"category-dropdown",children:o.map((d,m)=>e.jsx("div",{className:`category-option ${s.category===d?"selected":""}`,onClick:()=>{t(n=>({...n,category:d})),x(!1)},children:d},m))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-preview",children:[s.icon&&e.jsx("img",{src:s.icon,alt:"ç½‘ç«™å›¾æ ‡"}),e.jsx("input",{type:"text",value:s.icon,onChange:d=>t(m=>({...m,icon:d.target.value})),placeholder:"å›¾æ ‡URL"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:i,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"submit-button",children:"æ·»åŠ ä¹¦ç­¾"})]})]})}function F({analyzing:s,analysisStep:t,analysisError:o,urlExists:a}){const i=["å¼€å§‹åˆ†æž","éªŒè¯URLæ ¼å¼","èŽ·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æžç»“æžœ","åˆ†æžå®Œæˆ"];return e.jsxs(e.Fragment,{children:[s&&e.jsxs("div",{className:"analysis-status",children:[e.jsx("h3",{children:"æ­£åœ¨åˆ†æžç½‘ç«™..."}),e.jsx("div",{className:"analysis-steps",children:i.map((h,x)=>e.jsxs("div",{className:`analysis-step ${t===h?"active":""} ${i.indexOf(h)<i.indexOf(t)?"complete":""}`,children:[e.jsx("div",{className:"step-indicator",children:x+1}),e.jsx("div",{className:"step-label",children:h})]},x))})]}),a&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:"è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­"}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šæ‚¨å¯ä»¥åœ¨ä¹¦ç­¾åˆ—è¡¨ä¸­æŸ¥æ‰¾æ­¤ç½‘ç«™ã€‚"})]}),o&&!a&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:o}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç¨åŽå†è¯•ã€‚"})]})]})}function H({onClose:s,onSubmit:t}){const{list:o}=E(),[a,i]=u.useState(""),[h,x]=u.useState({url:"",name:"",category:"",icon:""}),[p,d]=u.useState(!1),[m,n]=u.useState(null),[r,g]=u.useState(null),[f,j]=u.useState(!1),[w,C]=u.useState([]),[k,v]=u.useState(!1);u.useEffect(()=>{if(o&&o.length>0){const c=[...new Set(o.map(y=>y.category).filter(Boolean))];C(c)}},[o]);const N=async()=>{if(!(!a||!a.trim())){d(!0),n("å¼€å§‹åˆ†æž"),g(null),j(!1),v(!1);try{n("éªŒè¯URLæ ¼å¼");let c=a;!a.startsWith("http://")&&!a.startsWith("https://")&&(c="https://"+a);const y=c.toLowerCase().replace(/\/$/,"");if(U(y,o)){v(!0),g("è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­"),d(!1);return}n("èŽ·å–ç½‘ç«™å…ƒæ•°æ®");const L=await M(c);n("å¤„ç†åˆ†æžç»“æžœ"),x({url:c,name:L.title||"",icon:L.icon||"",category:L.suggestedCategory||""}),n("åˆ†æžå®Œæˆ"),j(!0)}catch(c){g(`åœ¨"${m}"æ­¥éª¤å¤±è´¥: ${c.message}`)}finally{d(!1)}}},l=c=>{const y=c.url.toLowerCase().replace(/\/$/,"");if(U(y,o)){v(!0),g("è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­");return}t(c),s()};return e.jsx(_,{isOpen:!0,onClose:s,title:"æ·»åŠ æ–°ä¹¦ç­¾",size:"md",position:"center",children:e.jsxs("div",{className:"bookmark-modal-content",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ç½‘å€"}),e.jsxs("div",{className:"url-input-container",children:[e.jsx("input",{type:"url",value:a,onChange:c=>i(c.target.value),placeholder:"è¾“å…¥ç½‘ç«™åœ°å€",required:!0}),e.jsx("button",{type:"button",className:"analyze-button",onClick:N,disabled:p||!a,children:"åˆ†æž"})]})]}),e.jsx(F,{analyzing:p,analysisStep:m,analysisError:r,urlExists:k}),f&&e.jsx(D,{formData:h,setFormData:x,categories:w,onSubmit:l,onCancel:s})]})})}function I({bookmark:s,onClose:t,onSubmit:o}){const{list:a}=E(),[i,h]=u.useState({name:s.name,category:s.category,icon:s.icon}),[x,p]=u.useState([]),[d,m]=u.useState(!1);u.useEffect(()=>{if(a&&a.length>0){const r=[...new Set(a.map(g=>g.category).filter(Boolean))];p(r)}},[a]),u.useEffect(()=>{const r=g=>{d&&!g.target.closest(".category-select-container")&&m(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[d]);const n=r=>{r.preventDefault(),o({...s,...i})};return e.jsx(_,{isOpen:!0,onClose:t,title:"ç¼–è¾‘ä¹¦ç­¾",size:"md",position:"center",children:e.jsx("div",{className:"bookmark-modal-content",children:e.jsxs("form",{onSubmit:n,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:i.name,onChange:r=>h({...i,name:r.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-input-container",children:[e.jsx("input",{type:"text",value:i.icon,onChange:r=>h({...i,icon:r.target.value}),placeholder:"è¾“å…¥å›¾æ ‡ URL"}),i.icon&&e.jsx("div",{className:"icon-preview",children:e.jsx("img",{src:i.icon,alt:"å›¾æ ‡é¢„è§ˆ",onError:r=>r.target.src="/fallback-icon.svg"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:i.category,onChange:r=>h({...i,category:r.target.value}),onFocus:()=>m(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»"}),d&&x.length>0&&e.jsx("div",{className:"category-dropdown",children:x.map(r=>e.jsx("div",{className:`category-option ${r===i.category?"selected":""}`,onClick:()=>{h({...i,category:r}),m(!1)},children:r},r))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:t,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"submit-button",children:"ä¿å­˜ä¿®æ”¹"})]})]})})})}function T({message:s,type:t="success",onClose:o,duration:a=3e3}){return u.useEffect(()=>{const i=setTimeout(()=>{o()},a);return()=>clearTimeout(i)},[a,o]),e.jsxs("div",{className:`notification notification-${t}`,children:[e.jsx("span",{className:"notification-icon",children:t==="success"?"âœ“":"âœ•"}),e.jsx("span",{className:"notification-message",children:s})]})}function W({onRestore:s,onNotify:t}){const[o,a]=u.useState([]),[i,h]=u.useState(!1),[x,p]=u.useState(new Set),d=async()=>{h(!0);try{const{data:n}=await b.from("bookmark_history").select("restored_from_id").not("restored_from_id","is",null),r=new Set((n==null?void 0:n.map(j=>j.restored_from_id))||[]);p(r);const{data:g,error:f}=await b.from("bookmark_history").select("*").order("created_at",{ascending:!1});if(f)throw f;a(g)}catch(n){console.error("èŽ·å–åŽ†å²è®°å½•å¤±è´¥:",n),t==null||t({type:"error",message:"èŽ·å–åŽ†å²è®°å½•å¤±è´¥"})}finally{h(!1)}};u.useEffect(()=>{d()},[]);const m=async n=>{try{const{bookmark_data:r}=n,{error:g}=await b.from("bookmark").insert([r]);if(g)throw g;const{error:f}=await b.from("bookmark_history").insert([{action:"restore",bookmark_id:r.id,bookmark_data:r,restored_from_id:n.id}]);if(f)throw f;t==null||t({type:"success",message:"ä¹¦ç­¾æ¢å¤æˆåŠŸ"}),s==null||s(),d()}catch(r){console.error("æ¢å¤ä¹¦ç­¾å¤±è´¥:",r),t==null||t({type:"error",message:"æ¢å¤ä¹¦ç­¾å¤±è´¥"})}};return e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"æ“ä½œåŽ†å²"}),e.jsx("span",{className:"history-count",children:i?"åŠ è½½ä¸­...":`${o.length} æ¡è®°å½•`})]}),i?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½åŽ†å²è®°å½•..."})]}):e.jsx("div",{className:"history-list",children:o.map(n=>e.jsxs("div",{className:"history-item",children:[e.jsxs("div",{className:"history-content",children:[e.jsxs("span",{className:"history-action",children:[n.action==="add"&&"æ·»åŠ äº†",n.action==="delete"&&"åˆ é™¤äº†",n.action==="update"&&"ä¿®æ”¹äº†",n.action==="restore"&&"æ¢å¤äº†"]}),e.jsx("span",{className:"history-name",children:n.bookmark_data.name}),e.jsx("span",{className:"history-time",children:z(new Date(n.created_at),{addSuffix:!0,locale:A})})]}),n.action==="delete"&&!x.has(n.id)&&e.jsx("button",{className:"restore-button",onClick:()=>m(n),children:"æ¢å¤"})]},n.id))})]})}function V(){const[s,t]=u.useState(!0),{list:o,fetchBookmarks:a}=E();u.useEffect(()=>{(async()=>{t(!0),await a(),t(!1)})()},[]);const[i,h]=u.useState(!1),[x,p]=u.useState(null),d=l=>{navigator.clipboard.writeText(l).then(()=>{p({type:"success",message:"URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿"})}).catch(()=>{p({type:"error",message:"å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶"})})},m=async l=>{try{const c=Date.now()+Math.floor(Math.random()*1e3),y={...l,id:c,create_at:new Date().toISOString()},{error:S}=await b.from("bookmark").insert([y]).select();if(S)throw S;await N("add",y),p({type:"success",message:"æˆåŠŸæ·»åŠ ä¹¦ç­¾"}),a()}catch(c){console.log(c),p({type:"error",message:"æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"})}},n=async l=>{try{const{error:c}=await b.from("bookmark").delete().eq("url",l.url);if(c)throw c;await N("delete",l),p({type:"success",message:"æˆåŠŸåˆ é™¤ä¹¦ç­¾"}),a()}catch(c){console.error(c),p({type:"error",message:"åˆ é™¤ä¹¦ç­¾å¤±è´¥"})}},[r,g]=u.useState(!1),[f,j]=u.useState(null),w=l=>{j(l),g(!0)},C=async l=>{try{const{error:c}=await b.from("bookmark").update({name:l.name,category:l.category,icon:l.icon}).eq("url",l.url);if(c)throw c;await N("update",l),p({type:"success",message:"æˆåŠŸæ›´æ–°ä¹¦ç­¾"}),a()}catch(c){console.error(c),p({type:"error",message:"æ›´æ–°ä¹¦ç­¾å¤±è´¥"})}g(!1),j(null)},[k,v]=u.useState(!1),N=async(l,c)=>{try{await b.from("bookmark_history").insert([{action:l,bookmark_id:c.id,bookmark_data:c}])}catch(y){console.error("è®°å½•åŽ†å²å¤±è´¥:",y)}};return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:`tab-button ${k?"":"active"}`,onClick:()=>v(!1),children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsx("button",{className:`tab-button ${k?"active":""}`,onClick:()=>v(!0),children:"æ“ä½œåŽ†å²"})]}),e.jsx("div",{className:"dashboard-content",children:k?e.jsx(W,{onRestore:a,onNotify:p}):e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"add-button",onClick:()=>h(!0),children:[e.jsx("span",{className:"button-icon",children:"+"}),"æ·»åŠ ä¹¦ç­¾"]}),e.jsx("span",{className:"bookmark-count",children:s?"åŠ è½½ä¸­...":`${o.length} ä¸ªä¹¦ç­¾`})]})]}),s?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½ä¹¦ç­¾..."})]}):e.jsx("div",{className:"bookmark-list",children:o.map(l=>e.jsxs("div",{className:"bookmark-item",children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{"data-name":l.name,"data-category":l.category,src:l.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:c=>{c.target.src="/fallback-icon.svg"}})}),e.jsxs("div",{className:"bookmark-info",children:[e.jsx("h3",{children:l.name}),e.jsx("p",{className:"category-tag",children:l.category}),e.jsxs("div",{className:"url-container",children:[e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",children:l.url}),e.jsx("button",{className:"copy-button",onClick:c=>{c.preventDefault(),d(l.url)},title:"å¤åˆ¶URL",children:"ðŸ“‹"})]})]}),e.jsxs("div",{className:"bookmark-actions",children:[e.jsx("button",{className:"edit-button",onClick:()=>w(l),title:"ç¼–è¾‘ä¹¦ç­¾",children:"âœï¸"}),e.jsx("button",{className:"delete-button",onClick:()=>n(l),title:"åˆ é™¤ä¹¦ç­¾",children:e.jsx("span",{className:"delete-icon",children:"Ã—"})})]})]},l.url))})]})}),i&&e.jsx(H,{onClose:()=>h(!1),onSubmit:m}),r&&f&&e.jsx(I,{bookmark:f,onClose:()=>{g(!1),j(null)},onSubmit:C}),x&&e.jsx(T,{type:x.type,message:x.message,onClose:()=>p(null)})]})}export{V as default};
