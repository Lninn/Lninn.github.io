import{s as w,j as e}from"./index-Ct-Fg0Nq.js";import{b as n}from"./vendor-C_ovgAfI.js";import{c as G,f as J}from"./utils-CWHH1IbV.js";import{z as K}from"./zh-CN-CCt-M6vz.js";const z=G(u=>({list:[],fetchBookmarks:async()=>{const{data:i,error:d}=await w.from("bookmark").select("*").order("create_at",{ascending:!1});if(d){console.error("Failed to fetch bookmark data:",d);return}u({list:i})}}));function Q({onClose:u,onSubmit:i}){const{list:d}=z(),[c,m]=n.useState(""),[h,g]=n.useState({url:"",name:"",category:"",icon:""}),[p,j]=n.useState(!1),[y,r]=n.useState(null),[o,x]=n.useState(null),[b,N]=n.useState(!1),[D,q]=n.useState([]),[k,S]=n.useState(!1),[C,t]=n.useState(!1);n.useEffect(()=>{if(d&&d.length>0){const s=[...new Set(d.map(a=>a.category).filter(Boolean))];q(s)}},[d]),n.useEffect(()=>{const s=a=>{k&&!a.target.closest(".category-select-container")&&S(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[k]);const l=async()=>{if(!(!c||!c.trim())){j(!0),r("å¼€å§‹åˆ†æ"),x(null),N(!1),t(!1);try{r("éªŒè¯URLæ ¼å¼");let s=c;!c.startsWith("http://")&&!c.startsWith("https://")&&(s="https://"+c);const a=s.toLowerCase().replace(/\/$/,"");if(d.some(U=>U.url.toLowerCase().replace(/\/$/,"")===a)){t(!0),x("è¯¥URLå·²å­˜åœ¨äºæ‚¨çš„ä¹¦ç­¾ä¸­"),j(!1);return}r("è·å–ç½‘ç«™å…ƒæ•°æ®");const f=await L(s);r("å¤„ç†åˆ†æç»“æœ"),g({url:s,name:f.title||"",icon:f.icon||"",category:f.suggestedCategory||""}),r("åˆ†æå®Œæˆ"),N(!0)}catch(s){x(`åœ¨"${y}"æ­¥éª¤å¤±è´¥: ${s.message}`)}finally{j(!1)}}},L=async s=>{var a,v,f,U;try{const _="https://api.allorigins.win/get?url="+encodeURIComponent(s),B=await(await fetch(_)).json();if(!B.contents)throw new Error("æ— æ³•è·å–ç½‘ç«™å†…å®¹");const E=new DOMParser().parseFromString(B.contents,"text/html");let A=((a=E.querySelector("title"))==null?void 0:a.textContent)||"";A||(A=((v=E.querySelector('meta[property="og:title"]'))==null?void 0:v.getAttribute("content"))||"");let $="";const O=E.querySelector('link[rel="icon"]')||E.querySelector('link[rel="shortcut icon"]');O&&($=new URL(O.getAttribute("href"),s).href),$||($=`https://www.google.com/s2/favicons?domain=${s}`);let T=((f=E.querySelector('meta[name="keywords"]'))==null?void 0:f.getAttribute("content"))||"",W=((U=E.querySelector('meta[name="description"]'))==null?void 0:U.getAttribute("content"))||"",P=R(T+" "+W)||F(new URL(s).hostname);return{title:A||M(s),icon:$,suggestedCategory:P}}catch(_){return console.error("è·å–ç½‘ç«™ä¿¡æ¯å¤±è´¥:",_),H(s)}},R=(s="")=>{const a=s.toLowerCase(),v={æŠ€æœ¯:["programming","developer","coding","ç¼–ç¨‹","å¼€å‘","æŠ€æœ¯"],æ–°é—»:["news","daily","report","æ–°é—»","èµ„è®¯"],è´­ç‰©:["shop","store","buy","price","å•†åŸ","è´­ç‰©"],æ•™è‚²:["learn","course","education","study","æ•™è‚²","å­¦ä¹ "],å¨±ä¹:["game","entertainment","movie","music","æ¸¸æˆ","ç”µå½±","éŸ³ä¹"],ç¤¾äº¤:["social","community","forum","ç¤¾åŒº","è®ºå›"]};for(const[f,U]of Object.entries(v))if(U.some(_=>a.includes(_)))return f;return null},M=s=>{try{const a=new URL(s).hostname;return a.split(".")[0].charAt(0).toUpperCase()+a.split(".")[0].slice(1)}catch{return s}},H=s=>{try{const a=new URL(s).hostname;return{title:M(s),icon:`https://www.google.com/s2/favicons?domain=${s}`,suggestedCategory:F(a)}}catch{throw new Error("æ— æ•ˆçš„URLæ ¼å¼")}},F=s=>{const a={github:"å¼€å‘å·¥å…·",stackoverflow:"å¼€å‘å·¥å…·",youtube:"è§†é¢‘",bilibili:"è§†é¢‘",google:"æœç´¢",baidu:"æœç´¢",zhihu:"ç¤¾äº¤",weibo:"ç¤¾äº¤",twitter:"ç¤¾äº¤",facebook:"ç¤¾äº¤",instagram:"ç¤¾äº¤",amazon:"è´­ç‰©",taobao:"è´­ç‰©",jd:"è´­ç‰©"};for(const[v,f]of Object.entries(a))if(s.includes(v))return f;return"å…¶ä»–"},I=s=>{s.preventDefault();const a=h.url.toLowerCase().replace(/\/$/,"");if(d.some(f=>f.url.toLowerCase().replace(/\/$/,"")===a)){t(!0),x("è¯¥URLå·²å­˜åœ¨äºæ‚¨çš„ä¹¦ç­¾ä¸­");return}i(h),u()};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-bookmark-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"æ·»åŠ æ–°ä¹¦ç­¾"}),e.jsx("button",{className:"close-button",onClick:u,children:"Ã—"})]}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ç½‘å€"}),e.jsxs("div",{className:"url-input-container",children:[e.jsx("input",{type:"url",value:c,onChange:s=>m(s.target.value),placeholder:"è¾“å…¥ç½‘ç«™åœ°å€",required:!0}),e.jsx("button",{type:"button",className:"analyze-button",onClick:l,disabled:p||!c,children:"åˆ†æ"})]})]}),p&&e.jsxs("div",{className:"analysis-status",children:[e.jsx("h3",{children:"æ­£åœ¨åˆ†æç½‘ç«™..."}),e.jsx("div",{className:"analysis-steps",children:["å¼€å§‹åˆ†æ","éªŒè¯URLæ ¼å¼","è·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æç»“æœ","åˆ†æå®Œæˆ"].map((s,a)=>e.jsxs("div",{className:`analysis-step ${y===s?"active":""} ${["å¼€å§‹åˆ†æ","éªŒè¯URLæ ¼å¼","è·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æç»“æœ"].indexOf(s)<["å¼€å§‹åˆ†æ","éªŒè¯URLæ ¼å¼","è·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æç»“æœ"].indexOf(y)?"complete":""}`,children:[e.jsx("div",{className:"step-indicator",children:a+1}),e.jsx("div",{className:"step-label",children:s})]},a))})]}),C&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:"è¯¥URLå·²å­˜åœ¨äºæ‚¨çš„ä¹¦ç­¾ä¸­"}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šæ‚¨å¯ä»¥åœ¨ä¹¦ç­¾åˆ—è¡¨ä¸­æŸ¥æ‰¾æ­¤ç½‘ç«™ã€‚"})]}),o&&!C&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:o}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç¨åå†è¯•ã€‚"})]}),b&&e.jsxs("form",{onSubmit:I,className:"bookmark-form",children:[e.jsx("h3",{children:"ä¹¦ç­¾ä¿¡æ¯"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:h.name,onChange:s=>g(a=>({...a,name:s.target.value})),placeholder:"ä¹¦ç­¾åç§°",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:h.category,onChange:s=>g(a=>({...a,category:s.target.value})),onFocus:()=>S(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»",required:!0}),k&&D.length>0&&e.jsx("div",{className:"category-dropdown",children:D.map((s,a)=>e.jsx("div",{className:`category-option ${h.category===s?"selected":""}`,onClick:()=>{g(v=>({...v,category:s})),S(!1)},children:s},a))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-preview",children:[h.icon&&e.jsx("img",{src:h.icon,alt:"ç½‘ç«™å›¾æ ‡"}),e.jsx("input",{type:"text",value:h.icon,onChange:s=>g(a=>({...a,icon:s.target.value})),placeholder:"å›¾æ ‡URL"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:u,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"submit-button",children:"æ·»åŠ ä¹¦ç­¾"})]})]})]})]})})}function V({bookmark:u,onClose:i,onSubmit:d}){const{list:c}=z(),[m,h]=n.useState({name:u.name,category:u.category,icon:u.icon}),[g,p]=n.useState([]),[j,y]=n.useState(!1);n.useEffect(()=>{if(c&&c.length>0){const o=[...new Set(c.map(x=>x.category).filter(Boolean))];p(o)}},[c]);const r=o=>{o.preventDefault(),d({...u,...m})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-bookmark-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"ç¼–è¾‘ä¹¦ç­¾"}),e.jsx("button",{className:"close-button",onClick:i,children:"Ã—"})]}),e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:m.name,onChange:o=>h({...m,name:o.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡ URL"}),e.jsxs("div",{className:"icon-input-container",children:[e.jsx("input",{type:"text",value:m.icon,onChange:o=>h({...m,icon:o.target.value}),placeholder:"è¾“å…¥å›¾æ ‡ URL"}),m.icon&&e.jsx("div",{className:"icon-preview",children:e.jsx("img",{src:m.icon,alt:"å›¾æ ‡é¢„è§ˆ",onError:o=>o.target.src="/fallback-icon.svg"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:m.category,onChange:o=>h({...m,category:o.target.value}),onFocus:()=>y(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»"}),j&&g.length>0&&e.jsx("div",{className:"category-dropdown",children:g.map(o=>e.jsx("div",{className:`category-option ${o===m.category?"selected":""}`,onClick:()=>{h({...m,category:o}),y(!1)},children:o},o))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:i,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"submit-button",children:"ä¿å­˜ä¿®æ”¹"})]})]})})]})})}function X({message:u,type:i="success",onClose:d,duration:c=3e3}){return n.useEffect(()=>{const m=setTimeout(()=>{d()},c);return()=>clearTimeout(m)},[c,d]),e.jsxs("div",{className:`notification notification-${i}`,children:[e.jsx("span",{className:"notification-icon",children:i==="success"?"âœ“":"âœ•"}),e.jsx("span",{className:"notification-message",children:u})]})}function Y({onRestore:u,onNotify:i}){const[d,c]=n.useState([]),[m,h]=n.useState(!1),[g,p]=n.useState(new Set),j=async()=>{h(!0);try{const{data:r}=await w.from("bookmark_history").select("restored_from_id").not("restored_from_id","is",null),o=new Set((r==null?void 0:r.map(N=>N.restored_from_id))||[]);p(o);const{data:x,error:b}=await w.from("bookmark_history").select("*").order("created_at",{ascending:!1});if(b)throw b;c(x)}catch(r){console.error("è·å–å†å²è®°å½•å¤±è´¥:",r),i==null||i({type:"error",message:"è·å–å†å²è®°å½•å¤±è´¥"})}finally{h(!1)}};n.useEffect(()=>{j()},[]);const y=async r=>{try{const{bookmark_data:o}=r,{error:x}=await w.from("bookmark").insert([o]);if(x)throw x;const{error:b}=await w.from("bookmark_history").insert([{action:"restore",bookmark_id:o.id,bookmark_data:o,restored_from_id:r.id}]);if(b)throw b;i==null||i({type:"success",message:"ä¹¦ç­¾æ¢å¤æˆåŠŸ"}),u==null||u(),j()}catch(o){console.error("æ¢å¤ä¹¦ç­¾å¤±è´¥:",o),i==null||i({type:"error",message:"æ¢å¤ä¹¦ç­¾å¤±è´¥"})}};return e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"æ“ä½œå†å²"}),e.jsx("span",{className:"history-count",children:m?"åŠ è½½ä¸­...":`${d.length} æ¡è®°å½•`})]}),m?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½å†å²è®°å½•..."})]}):e.jsx("div",{className:"history-list",children:d.map(r=>e.jsxs("div",{className:"history-item",children:[e.jsxs("div",{className:"history-content",children:[e.jsxs("span",{className:"history-action",children:[r.action==="add"&&"æ·»åŠ äº†",r.action==="delete"&&"åˆ é™¤äº†",r.action==="update"&&"ä¿®æ”¹äº†",r.action==="restore"&&"æ¢å¤äº†"]}),e.jsx("span",{className:"history-name",children:r.bookmark_data.name}),e.jsx("span",{className:"history-time",children:J(new Date(r.created_at),{addSuffix:!0,locale:K})})]}),r.action==="delete"&&!g.has(r.id)&&e.jsx("button",{className:"restore-button",onClick:()=>y(r),children:"æ¢å¤"})]},r.id))})]})}function oe(){const[u,i]=n.useState(!0),{list:d,fetchBookmarks:c}=z();n.useEffect(()=>{(async()=>{i(!0),await c(),i(!1)})()},[]);const[m,h]=n.useState(!1),[g,p]=n.useState(null),j=t=>{navigator.clipboard.writeText(t).then(()=>{p({type:"success",message:"URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿"})}).catch(()=>{p({type:"error",message:"å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶"})})},y=async t=>{try{const l=Date.now()+Math.floor(Math.random()*1e3),L={...t,id:l,create_at:new Date().toISOString()},{error:R}=await w.from("bookmark").insert([L]).select();if(R)throw R;await C("add",L),p({type:"success",message:"æˆåŠŸæ·»åŠ ä¹¦ç­¾"}),c()}catch(l){console.log(l),p({type:"error",message:"æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"})}},r=async t=>{try{const{error:l}=await w.from("bookmark").delete().eq("url",t.url);if(l)throw l;await C("delete",t),p({type:"success",message:"æˆåŠŸåˆ é™¤ä¹¦ç­¾"}),c()}catch(l){console.error(l),p({type:"error",message:"åˆ é™¤ä¹¦ç­¾å¤±è´¥"})}},[o,x]=n.useState(!1),[b,N]=n.useState(null),D=t=>{N(t),x(!0)},q=async t=>{try{const{error:l}=await w.from("bookmark").update({name:t.name,category:t.category,icon:t.icon}).eq("url",t.url);if(l)throw l;await C("update",t),p({type:"success",message:"æˆåŠŸæ›´æ–°ä¹¦ç­¾"}),c()}catch(l){console.error(l),p({type:"error",message:"æ›´æ–°ä¹¦ç­¾å¤±è´¥"})}x(!1),N(null)},[k,S]=n.useState(!1),C=async(t,l)=>{try{await w.from("bookmark_history").insert([{action:t,bookmark_id:l.id,bookmark_data:l}])}catch(L){console.error("è®°å½•å†å²å¤±è´¥:",L)}};return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:`tab-button ${k?"":"active"}`,onClick:()=>S(!1),children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsx("button",{className:`tab-button ${k?"active":""}`,onClick:()=>S(!0),children:"æ“ä½œå†å²"})]}),e.jsx("div",{className:"dashboard-content",children:k?e.jsx(Y,{onRestore:c,onNotify:p}):e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"add-button",onClick:()=>h(!0),children:[e.jsx("span",{className:"button-icon",children:"+"}),"æ·»åŠ ä¹¦ç­¾"]}),e.jsx("span",{className:"bookmark-count",children:u?"åŠ è½½ä¸­...":`${d.length} ä¸ªä¹¦ç­¾`})]})]}),u?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½ä¹¦ç­¾..."})]}):e.jsx("div",{className:"bookmark-list",children:d.map(t=>e.jsxs("div",{className:"bookmark-item",children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{"data-name":t.name,"data-category":t.category,src:t.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:l=>{l.target.src="/fallback-icon.svg"}})}),e.jsxs("div",{className:"bookmark-info",children:[e.jsx("h3",{children:t.name}),e.jsx("p",{className:"category-tag",children:t.category}),e.jsxs("div",{className:"url-container",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:t.url}),e.jsx("button",{className:"copy-button",onClick:l=>{l.preventDefault(),j(t.url)},title:"å¤åˆ¶URL",children:"ğŸ“‹"})]})]}),e.jsxs("div",{className:"bookmark-actions",children:[e.jsx("button",{className:"edit-button",onClick:()=>D(t),title:"ç¼–è¾‘ä¹¦ç­¾",children:"âœï¸"}),e.jsx("button",{className:"delete-button",onClick:()=>r(t),title:"åˆ é™¤ä¹¦ç­¾",children:e.jsx("span",{className:"delete-icon",children:"Ã—"})})]})]},t.url))})]})}),m&&e.jsx(Q,{onClose:()=>h(!1),onSubmit:y}),o&&b&&e.jsx(V,{bookmark:b,onClose:()=>{x(!1),N(null)},onSubmit:q}),g&&e.jsx(X,{type:g.type,message:g.message,onClose:()=>p(null)})]})}export{oe as default};
