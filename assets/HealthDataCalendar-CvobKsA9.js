import{j as e}from"./index-odEpW_LG.js";import{b as p}from"./vendor-Bu9rO6sl.js";import{CalendarIcon as D,Select as E,Row as T,Col as j,Card as m,Statistic as v,FireIcon as f,Tooltip as k}from"./UIComponents-Cd59K_VH.js";import"./utils-Pd6Wu3Vt.js";const Y=(l,r)=>{if(l===0||r===0)return 0;const x=4,d=Math.log(r+1)/Math.log(x),o=Math.log(l+1)/Math.log(x);return Math.min(Math.ceil(o/d*4),4)},L=({data:l})=>{const[r,x]=p.useState("all"),{calendarData:d,years:o,activityTypes:y,stats:h}=p.useMemo(()=>{if(!l||!l.data)return{calendarData:[],years:[],activityTypes:[],stats:{}};const s=[...new Set(l.data.map(a=>new Date(a.date).getFullYear()))].sort(),t={};s.forEach(a=>{t[a]=Array(53).fill().map(()=>Array(7).fill(null))}),l.data.forEach(a=>{const n=new Date(a.date),c=n.getFullYear(),u=new Date(c,0,1),$=Math.floor((n-u)/(24*60*60*1e3)),N=Math.floor($/7),A=n.getDay();t[c]&&t[c][N]&&(t[c][N][A]={date:a.date,count:a.count,details:a.details})});const i={totalDays:l.data.length,totalActivities:l.data.reduce((a,n)=>a+n.count,0),maxDailyActivities:Math.max(...l.data.map(a=>a.count)),averageDailyActivities:Math.round(l.data.reduce((a,n)=>a+n.count,0)/l.data.length)};return{calendarData:t,years:s,activityTypes:["all",...l.activityTypes],stats:i}},[l]),g=s=>s?r==="all"?s.count:s.details[r]||0:0,M=p.useMemo(()=>{let s=0;return o.forEach(t=>{d[t].forEach(i=>{i.forEach(a=>{if(a){const n=g(a);n>s&&(s=n)}})})}),s},[d,o,r]),w=()=>{const s=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];return e.jsx("div",{className:"month-labels",children:s.map((t,i)=>e.jsx("div",{className:"month-label",style:{left:`${i*8.3+2}%`},children:t},t))})},b=()=>{const s=["周日","周一","周二","周三","周四","周五","周六"];return e.jsx("div",{className:"weekday-labels",children:s.map(t=>e.jsx("div",{className:"weekday-label",children:t},t))})},C=s=>e.jsxs("div",{className:"year-calendar",children:[e.jsxs("h3",{children:[s,"年"]}),e.jsxs("div",{className:"calendar-grid",children:[w(),e.jsxs("div",{className:"calendar-body",children:[b(),e.jsx("div",{className:"calendar-cells",children:d[s].map((t,i)=>e.jsx("div",{className:"calendar-week",children:t.map((a,n)=>{const c=g(a),u=Y(c,M);return e.jsx(k,{title:a?`${a.date}: ${c} 活动`:"无数据",children:e.jsx("div",{className:`calendar-day intensity-${u}`,"data-date":a?a.date:""})},`${s}-w${i}-d${n}`)})},`${s}-w${i}`))})]})]})]},s);return e.jsxs("div",{className:"health-data-calendar",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("div",{className:"calendar-title",children:e.jsxs("h2",{children:[e.jsx(D,{})," 健康数据活动热图"]})}),e.jsxs("div",{className:"calendar-filter",children:[e.jsx("span",{children:"活动类型: "}),e.jsx(E,{value:r,onChange:x,style:{width:200},options:y.map(s=>({value:s,label:s==="all"?"所有活动":s}))})]})]}),e.jsxs(T,{gutter:16,className:"stats-cards",children:[e.jsx(j,{span:6,children:e.jsx(m,{children:e.jsx(v,{title:"记录天数",value:h.totalDays,prefix:e.jsx(D,{}),suffix:"天"})})}),e.jsx(j,{span:6,children:e.jsx(m,{children:e.jsx(v,{title:"总活动数",value:h.totalActivities,prefix:e.jsx(f,{})})})}),e.jsx(j,{span:6,children:e.jsx(m,{children:e.jsx(v,{title:"单日最高活动",value:h.maxDailyActivities,prefix:e.jsx(f,{})})})}),e.jsx(j,{span:6,children:e.jsx(m,{children:e.jsx(v,{title:"日均活动",value:h.averageDailyActivities,prefix:e.jsx(f,{})})})})]}),e.jsxs("div",{className:"calendar-legend",children:[e.jsx("span",{children:"活动频率: "}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-0"}),e.jsx("span",{children:"无"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-1"}),e.jsx("span",{children:"低"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-2"}),e.jsx("span",{children:"中"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-3"}),e.jsx("span",{children:"高"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-4"}),e.jsx("span",{children:"很高"})]})]})]}),o.map(s=>C(s))]})};export{L as default};
