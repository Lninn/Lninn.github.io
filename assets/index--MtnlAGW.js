import{j as r}from"./index-DuC1sODx.js";import{b as n,h as $}from"./vendor-C_ovgAfI.js";function S({options:o=[],value:u,onChange:m,placeholder:b="请选择",disabled:l=!1,error:p,className:g=""}){const[t,a]=n.useState(!1),[c,x]=n.useState(-1),f=n.useRef(null),i=n.useRef(null),[h,j]=n.useState({top:0,left:0,width:0}),w=o.find(e=>e.value===u),v=n.useCallback(()=>{l||(t||d(),a(e=>!e))},[l,t]),d=n.useCallback(()=>{if(f.current){const e=f.current.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,k=window.pageYOffset||document.documentElement.scrollTop;j({top:e.bottom+k,left:e.left+s,width:e.width})}},[]),E=n.useCallback(e=>{m&&m(e.value),a(!1)},[m]),L=n.useCallback(e=>{if(!l)switch(e.key){case"Enter":t&&c>=0&&c<o.length?E(o[c]):v();break;case"Escape":a(!1);break;case"ArrowDown":e.preventDefault(),t?x(s=>s<o.length-1?s+1:s):(d(),a(!0));break;case"ArrowUp":e.preventDefault(),t&&x(s=>s>0?s-1:0);break;case" ":t||(e.preventDefault(),d(),a(!0));break}},[l,t,c,o,E,v,d]);n.useEffect(()=>{const e=s=>{f.current&&!f.current.contains(s.target)&&i.current&&!i.current.contains(s.target)&&a(!1)};return t&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[t]),n.useEffect(()=>{const e=()=>{t&&d()};return window.addEventListener("resize",e),window.addEventListener("scroll",e,!0),()=>{window.removeEventListener("resize",e),window.removeEventListener("scroll",e,!0)}},[t,d]),n.useEffect(()=>{if(t&&i.current&&w){const e=i.current.querySelector(".selected");e&&e.scrollIntoView({block:"nearest"})}},[t,w]),n.useEffect(()=>{if(t&&i.current&&c>=0){const e=i.current.querySelectorAll(".select-option")[c];e&&e.scrollIntoView({block:"nearest"})}},[t,c]),n.useEffect(()=>{if(t){const e=o.findIndex(s=>s.value===u);x(e>=0?e:0)}},[t,o,u]);const D=()=>{if(!t)return null;const e=r.jsxs("div",{className:"select-dropdown",ref:i,role:"listbox",style:{position:"fixed",top:`${h.top}px`,left:`${h.left}px`,width:`${h.width}px`},children:[o.map((s,k)=>r.jsx("div",{className:`select-option ${s.value===u?"selected":""} ${k===c?"focused":""}`,onClick:()=>E(s),role:"option","aria-selected":s.value===u,children:s.label},s.value)),o.length===0&&r.jsx("div",{className:"select-option",children:"无可用选项"})]});return $.createPortal(e,document.body)};return r.jsxs("div",{className:`select-container ${g}`,ref:f,children:[r.jsxs("div",{className:`select-trigger ${t?"open":""} ${l?"disabled":""} ${p?"error":""}`,onClick:v,onKeyDown:L,tabIndex:l?-1:0,role:"combobox","aria-expanded":t,"aria-haspopup":"listbox","aria-disabled":l,children:[r.jsx("div",{className:`select-value ${w?"":"select-placeholder"}`,children:w?w.label:b}),r.jsx("div",{className:`select-icon ${t?"open":""}`,children:r.jsx("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M2.5 4.5L6 8L9.5 4.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),D(),p&&r.jsx("div",{className:"select-error-message",children:p})]})}export{S};
