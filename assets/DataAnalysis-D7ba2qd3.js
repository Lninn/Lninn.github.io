import{j as s}from"./index-DZF8CRW-.js";import{b as f}from"./vendor-Bu9rO6sl.js";import{Select as C,Row as T,Col as d,Card as v,Statistic as y}from"./UIComponents-Fqnhoa0K.js";import"./utils-Pd6Wu3Vt.js";/* empty css                     */const E=({data:o})=>{const[r,p]=f.useState(null),S=f.useCallback(t=>{if(!t||t.length<2)return null;const m=t.length,n=t.map((a,b)=>b),i=t.map(a=>a.value);let e=0,c=0,h=0,u=0;for(let a=0;a<m;a++)e+=n[a],c+=i[a],h+=n[a]*i[a],u+=n[a]*n[a];const x=m*u-e*e;if(x===0)return{overall:0,direction:"稳定",recentValues:{last7Days:t.slice(-7).map(a=>a.value),last30Days:t.slice(-30).map(a=>a.value)},recentDates:{last7Days:t.slice(-7).map(a=>a.date),last30Days:t.slice(-30).map(a=>a.date)}};const j=(m*h-e*c)/x,D=Math.abs(j)/(Math.max(...i)-Math.min(...i)||1);return{overall:j,strength:D,direction:D<.01?"稳定":j>0?"上升":"下降",recentValues:{last7Days:t.slice(-7).map(a=>a.value),last30Days:t.slice(-30).map(a=>a.value)},recentDates:{last7Days:t.slice(-7).map(a=>a.date),last30Days:t.slice(-30).map(a=>a.date)}}},[]),l=f.useMemo(()=>{if(!o||!o.data||!Array.isArray(o.data))return null;const t={totalDays:o.data.length,totalRecords:0,activitySummary:{},trends:{},activityTypes:o.activityTypes||[]};if([...o.data].sort((i,e)=>new Date(i.date)-new Date(e.date)).forEach(i=>{t.totalRecords+=i.count||0,i.details&&Object.entries(i.details).forEach(([e,c])=>{t.activitySummary[e]||(t.activitySummary[e]={total:0,days:0,max:0,min:1/0,values:[]}),c>0&&(t.activitySummary[e].total+=c,t.activitySummary[e].days+=1,t.activitySummary[e].max=Math.max(t.activitySummary[e].max,c),t.activitySummary[e].min=Math.min(t.activitySummary[e].min,c),t.activitySummary[e].values.push({date:i.date,value:c}))})}),Object.keys(t.activitySummary).forEach(i=>{const e=t.activitySummary[i];if(e.days>0&&(e.average=e.total/e.days),e.min===1/0&&(e.min=0),e.values.length>1){const c=S(e.values);t.trends[i]=c}}),!r&&t.activityTypes.length>0){const i=t.activityTypes.find(e=>e.includes("Step")||e.includes("步数"));p(i||t.activityTypes[0])}const n=Object.keys(t.activitySummary);if(!r&&n.length>0){const i=n.find(e=>e.toLowerCase().includes("step")||e.toLowerCase().includes("步数"));setTimeout(()=>{p(i||n[0])},0)}return t},[o,r,S]),w=f.useCallback(t=>{if(!t)return null;let m,n;return t.direction==="上升"?(m=t.strength>.05?"⬆️":"↗️",n="#52c41a"):t.direction==="下降"?(m=t.strength>.05?"⬇️":"↘️",n="#f5222d"):(m="→",n="#1890ff"),s.jsxs("span",{style:{color:n,marginLeft:"5px"},children:[m," ",t.direction,t.strength>.05&&" (显著)"]})},[]),g=(t,m,n=50)=>{if(!t||t.length<2)return null;const i=Math.max(...t),e=Math.min(...t),c=i-e||1;return s.jsx("div",{className:"simple-chart",style:{height:`${n}px`},children:t.map((h,u)=>{const x=(h-e)/c*100;return s.jsx("div",{className:"chart-bar",style:{height:`${x}%`,backgroundColor:"#1890ff"},title:`${m[u]}: ${h}`},u)})})};return l?s.jsxs("div",{className:"data-analysis",children:[s.jsxs("div",{className:"analysis-header",children:[s.jsx("h3",{children:"数据分析"}),s.jsx(C,{value:r,onChange:p,options:[...l.activityTypes.map(t=>({value:t,label:t}))],placeholder:"选择活动类型",style:{width:"200px"}})]}),s.jsxs(T,{children:[s.jsx(d,{style:{width:"50%"},children:s.jsx(v,{children:s.jsx(y,{title:"总天数",value:l.totalDays,suffix:"天"})})}),s.jsx(d,{style:{width:"50%"},children:s.jsx(v,{children:s.jsx(y,{title:"总记录数",value:l.totalRecords,suffix:"条"})})})]}),r&&l.activitySummary[r]&&s.jsxs("div",{className:"selected-activity-analysis",children:[s.jsxs("h4",{style:{marginTop:"20px"},children:[r," 分析",l.trends[r]&&w(l.trends[r])]}),s.jsxs(v,{style:{marginBottom:"20px"},children:[s.jsxs(T,{children:[s.jsx(d,{style:{width:"25%"},children:s.jsx(y,{title:"总计",value:l.activitySummary[r].total.toFixed(2)})}),s.jsx(d,{style:{width:"25%"},children:s.jsx(y,{title:"平均值",value:l.activitySummary[r].average.toFixed(2)})}),s.jsx(d,{style:{width:"25%"},children:s.jsx(y,{title:"最大值",value:l.activitySummary[r].max.toFixed(2)})}),s.jsx(d,{style:{width:"25%"},children:s.jsx(y,{title:"记录天数",value:l.activitySummary[r].days,suffix:"天"})})]}),l.trends[r]&&s.jsxs("div",{className:"trend-charts",children:[s.jsx("h5",{children:"最近7天趋势"}),g(l.trends[r].recentValues.last7Days,l.trends[r].recentDates.last7Days),s.jsx("h5",{children:"最近30天趋势"}),g(l.trends[r].recentValues.last30Days,l.trends[r].recentDates.last30Days)]})]})]})]}):s.jsx("div",{children:"无数据可分析"})};export{E as default};
