import{s as w,j as e}from"./index-Cx-IRSR5.js";import{b as i}from"./vendor-C_ovgAfI.js";import{c as q,f as z}from"./utils-CWHH1IbV.js";import{M as _}from"./index-C2opUCAC.js";import{z as A}from"./zh-CN-CCt-M6vz.js";const E=q(t=>({list:[],fetchBookmarks:async()=>{const{data:a,error:n}=await w.from("bookmark").select("*").order("create_at",{ascending:!1});if(n){console.error("Failed to fetch bookmark data:",n);return}t({list:a})}})),M=async t=>{var a,n,r,o;try{const m="https://api.allorigins.win/get?url="+encodeURIComponent(t),u=await(await fetch(m)).json();if(!u.contents)throw new Error("æ— æ³•èŽ·å–ç½‘ç«™å†…å®¹");const f=new DOMParser().parseFromString(u.contents,"text/html");let s=((a=f.querySelector("title"))==null?void 0:a.textContent)||"";s||(s=((n=f.querySelector('meta[property="og:title"]'))==null?void 0:n.getAttribute("content"))||"");let d="";const g=f.querySelector('link[rel="icon"]')||f.querySelector('link[rel="shortcut icon"]');g&&(d=new URL(g.getAttribute("href"),t).href),d||(d=`https://www.google.com/s2/favicons?domain=${t}`);let j=((r=f.querySelector('meta[name="keywords"]'))==null?void 0:r.getAttribute("content"))||"",y=((o=f.querySelector('meta[name="description"]'))==null?void 0:o.getAttribute("content"))||"",N=O(j+" "+y)||R(new URL(t).hostname);return{title:s||$(t),icon:d,suggestedCategory:N}}catch(m){return console.error("èŽ·å–ç½‘ç«™ä¿¡æ¯å¤±è´¥:",m),D(t)}},O=(t="")=>{const a=t.toLowerCase(),n={æŠ€æœ¯:["programming","developer","coding","ç¼–ç¨‹","å¼€å‘","æŠ€æœ¯"],æ–°é—»:["news","daily","report","æ–°é—»","èµ„è®¯"],è´­ç‰©:["shop","store","buy","price","å•†åŸŽ","è´­ç‰©"],æ•™è‚²:["learn","course","education","study","æ•™è‚²","å­¦ä¹ "],å¨±ä¹:["game","entertainment","movie","music","æ¸¸æˆ","ç”µå½±","éŸ³ä¹"],ç¤¾äº¤:["social","community","forum","ç¤¾åŒº","è®ºå›"]};for(const[r,o]of Object.entries(n))if(o.some(m=>a.includes(m)))return r;return null},$=t=>{try{const a=new URL(t).hostname;return a.split(".")[0].charAt(0).toUpperCase()+a.split(".")[0].slice(1)}catch{return t}},D=t=>{try{const a=new URL(t).hostname;return{title:$(t),icon:`https://www.google.com/s2/favicons?domain=${t}`,suggestedCategory:R(a)}}catch{throw new Error("æ— æ•ˆçš„URLæ ¼å¼")}},R=t=>{const a={github:"å¼€å‘å·¥å…·",stackoverflow:"å¼€å‘å·¥å…·",youtube:"è§†é¢‘",bilibili:"è§†é¢‘",google:"æœç´¢",baidu:"æœç´¢",zhihu:"ç¤¾äº¤",weibo:"ç¤¾äº¤",twitter:"ç¤¾äº¤",facebook:"ç¤¾äº¤",instagram:"ç¤¾äº¤",amazon:"è´­ç‰©",taobao:"è´­ç‰©",jd:"è´­ç‰©"};for(const[n,r]of Object.entries(a))if(t.includes(n))return r;return"å…¶ä»–"},U=(t,a)=>{const n=t.toLowerCase().replace(/\/$/,"");return a.some(r=>r.url.toLowerCase().replace(/\/$/,"")===n)};function B({formData:t,setFormData:a,categories:n,onSubmit:r,onCancel:o}){const[m,p]=i.useState(!1),[u,x]=i.useState(!1);i.useEffect(()=>{const s=d=>{m&&!d.target.closest(".category-select-container")&&p(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[m]);const f=async s=>{if(s.preventDefault(),!u){x(!0);try{await r(t)}catch{throw new Error("æ·»åŠ ä¹¦ç­¾å¤±è´¥")}finally{x(!1)}}};return e.jsxs("form",{onSubmit:f,className:"bookmark-form",children:[e.jsx("h3",{children:"ä¹¦ç­¾ä¿¡æ¯"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>a(d=>({...d,name:s.target.value})),placeholder:"ä¹¦ç­¾åç§°",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:t.category,onChange:s=>a(d=>({...d,category:s.target.value})),onFocus:()=>p(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»",required:!0}),m&&n.length>0&&e.jsx("div",{className:"category-dropdown",children:n.map((s,d)=>e.jsx("div",{className:`category-option ${t.category===s?"selected":""}`,onClick:()=>{a(g=>({...g,category:s})),p(!1)},children:s},d))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-input-container",children:[e.jsx("input",{type:"text",value:t.icon,onChange:s=>a(d=>({...d,icon:s.target.value})),placeholder:"å›¾æ ‡URL"}),t.icon&&e.jsx("div",{className:"icon-preview",children:e.jsx("img",{src:t.icon,alt:"ç½‘ç«™å›¾æ ‡",onError:s=>s.target.src="/fallback-icon.svg"})})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:o,disabled:u,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:`submit-button ${u?"loading":""}`,disabled:u,children:u?"æ·»åŠ ä¸­...":"æ·»åŠ ä¹¦ç­¾"})]})]})}function F({analyzing:t,analysisStep:a,analysisError:n,urlExists:r}){const o=["å¼€å§‹åˆ†æž","éªŒè¯URLæ ¼å¼","èŽ·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æžç»“æžœ","åˆ†æžå®Œæˆ"];return e.jsxs(e.Fragment,{children:[t&&e.jsxs("div",{className:"analysis-status",children:[e.jsx("h3",{children:"æ­£åœ¨åˆ†æžç½‘ç«™..."}),e.jsx("div",{className:"analysis-steps",children:o.map((m,p)=>e.jsxs("div",{className:`analysis-step ${a===m?"active":""} ${o.indexOf(m)<o.indexOf(a)?"complete":""}`,children:[e.jsx("div",{className:"step-indicator",children:p+1}),e.jsx("div",{className:"step-label",children:m})]},p))})]}),r&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:"è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­"}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šæ‚¨å¯ä»¥åœ¨ä¹¦ç­¾åˆ—è¡¨ä¸­æŸ¥æ‰¾æ­¤ç½‘ç«™ã€‚"})]}),n&&!r&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:n}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç¨åŽå†è¯•ã€‚"})]})]})}function I({onClose:t,onSubmit:a}){const{list:n}=E(),[r,o]=i.useState(""),[m,p]=i.useState({url:"",name:"",category:"",icon:""}),[u,x]=i.useState(!1),[f,s]=i.useState(null),[d,g]=i.useState(null),[j,y]=i.useState(!1),[N,h]=i.useState([]),[v,k]=i.useState(!1);i.useEffect(()=>{if(n&&n.length>0){const c=[...new Set(n.map(b=>b.category).filter(Boolean))];h(c)}},[n]);const S=async()=>{if(!(!r||!r.trim())){x(!0),s("å¼€å§‹åˆ†æž"),g(null),y(!1),k(!1);try{s("éªŒè¯URLæ ¼å¼");let c=r;!r.startsWith("http://")&&!r.startsWith("https://")&&(c="https://"+r);const b=c.toLowerCase().replace(/\/$/,"");if(U(b,n)){k(!0),g("è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­"),x(!1);return}s("èŽ·å–ç½‘ç«™å…ƒæ•°æ®");const L=await M(c);s("å¤„ç†åˆ†æžç»“æžœ"),p({url:c,name:L.title||"",icon:L.icon||"",category:L.suggestedCategory||""}),s("åˆ†æžå®Œæˆ"),y(!0)}catch(c){g(`åœ¨"${f}"æ­¥éª¤å¤±è´¥: ${c.message}`)}finally{x(!1)}}},l=async c=>{try{const b=c.url.toLowerCase().replace(/\/$/,"");if(U(b,n)){k(!0),g("è¯¥URLå·²å­˜åœ¨äºŽæ‚¨çš„ä¹¦ç­¾ä¸­");return}await a(c),t()}catch(b){console.error("æ·»åŠ ä¹¦ç­¾å¤±è´¥:",b),g("æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·é‡è¯•")}};return e.jsx(_,{isOpen:!0,onClose:t,title:"æ·»åŠ æ–°ä¹¦ç­¾",size:"md",position:"center",children:e.jsxs("div",{className:"bookmark-modal-content",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ç½‘å€"}),e.jsxs("div",{className:"url-input-container",children:[e.jsx("input",{type:"url",value:r,onChange:c=>o(c.target.value),placeholder:"è¾“å…¥ç½‘ç«™åœ°å€",required:!0}),e.jsx("button",{type:"button",className:`analyze-button ${u?"loading":""}`,onClick:S,disabled:u||!r,children:u?"åˆ†æžä¸­...":"åˆ†æž"})]})]}),e.jsx(F,{analyzing:u,analysisStep:f,analysisError:d,urlExists:v}),j&&e.jsx(B,{formData:m,setFormData:p,categories:N,onSubmit:l,onCancel:t})]})})}function H({bookmark:t,onClose:a,onSubmit:n}){const{list:r}=E(),[o,m]=i.useState({name:t.name,category:t.category,icon:t.icon}),[p,u]=i.useState([]),[x,f]=i.useState(!1),[s,d]=i.useState(!1),[g,j]=i.useState(!1),y=i.useRef({name:t.name,category:t.category,icon:t.icon}).current;i.useEffect(()=>{const h=o.name!==y.name||o.category!==y.category||o.icon!==y.icon;j(h)},[o,y]),i.useEffect(()=>{if(r&&r.length>0){const h=[...new Set(r.map(v=>v.category).filter(Boolean))];u(h)}},[r]),i.useEffect(()=>{const h=v=>{x&&!v.target.closest(".category-select-container")&&f(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[x]);const N=async h=>{if(h.preventDefault(),!(!g||s)){d(!0);try{await n({...t,...o}),a()}catch(v){console.error("ä¿å­˜ä¹¦ç­¾å¤±è´¥:",v)}finally{d(!1)}}};return e.jsx(_,{isOpen:!0,onClose:a,title:"ç¼–è¾‘ä¹¦ç­¾",size:"md",position:"center",children:e.jsx("div",{className:"bookmark-modal-content",children:e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:o.name,onChange:h=>m({...o,name:h.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-input-container",children:[e.jsx("input",{type:"text",value:o.icon,onChange:h=>m({...o,icon:h.target.value}),placeholder:"è¾“å…¥å›¾æ ‡ URL"}),o.icon&&e.jsx("div",{className:"icon-preview",children:e.jsx("img",{src:o.icon,alt:"å›¾æ ‡é¢„è§ˆ",onError:h=>h.target.src="/fallback-icon.svg"})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:o.category,onChange:h=>m({...o,category:h.target.value}),onFocus:()=>f(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»"}),x&&p.length>0&&e.jsx("div",{className:"category-dropdown",children:p.map(h=>e.jsx("div",{className:`category-option ${h===o.category?"selected":""}`,onClick:()=>{m({...o,category:h}),f(!1)},children:h},h))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:a,disabled:s,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:`submit-button ${s?"loading":""}`,disabled:!g||s,children:s?"ä¿å­˜ä¸­...":"ä¿å­˜ä¿®æ”¹"})]})]})})})}function T({message:t,type:a="success",onClose:n,duration:r=3e3}){return i.useEffect(()=>{const o=setTimeout(()=>{n()},r);return()=>clearTimeout(o)},[r,n]),e.jsxs("div",{className:`notification notification-${a}`,children:[e.jsx("span",{className:"notification-icon",children:a==="success"?"âœ“":"âœ•"}),e.jsx("span",{className:"notification-message",children:t})]})}function W({onRestore:t,onNotify:a}){const[n,r]=i.useState([]),[o,m]=i.useState(!1),[p,u]=i.useState(new Set),x=async()=>{m(!0);try{const{data:s}=await w.from("bookmark_history").select("restored_from_id").not("restored_from_id","is",null),d=new Set((s==null?void 0:s.map(y=>y.restored_from_id))||[]);u(d);const{data:g,error:j}=await w.from("bookmark_history").select("*").order("created_at",{ascending:!1});if(j)throw j;r(g)}catch(s){console.error("èŽ·å–åŽ†å²è®°å½•å¤±è´¥:",s),a==null||a({type:"error",message:"èŽ·å–åŽ†å²è®°å½•å¤±è´¥"})}finally{m(!1)}};i.useEffect(()=>{x()},[]);const f=async s=>{try{const{bookmark_data:d}=s,{error:g}=await w.from("bookmark").insert([d]);if(g)throw g;const{error:j}=await w.from("bookmark_history").insert([{action:"restore",bookmark_id:d.id,bookmark_data:d,restored_from_id:s.id}]);if(j)throw j;a==null||a({type:"success",message:"ä¹¦ç­¾æ¢å¤æˆåŠŸ"}),t==null||t(),x()}catch(d){console.error("æ¢å¤ä¹¦ç­¾å¤±è´¥:",d),a==null||a({type:"error",message:"æ¢å¤ä¹¦ç­¾å¤±è´¥"})}};return e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"æ“ä½œåŽ†å²"}),e.jsx("span",{className:"history-count",children:o?"åŠ è½½ä¸­...":`${n.length} æ¡è®°å½•`})]}),o?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½åŽ†å²è®°å½•..."})]}):e.jsx("div",{className:"history-list",children:n.map(s=>e.jsxs("div",{className:"history-item",children:[e.jsxs("div",{className:"history-content",children:[e.jsxs("span",{className:"history-action",children:[s.action==="add"&&"æ·»åŠ äº†",s.action==="delete"&&"åˆ é™¤äº†",s.action==="update"&&"ä¿®æ”¹äº†",s.action==="restore"&&"æ¢å¤äº†"]}),e.jsx("span",{className:"history-name",children:s.bookmark_data.name}),e.jsx("span",{className:"history-time",children:z(new Date(s.created_at),{addSuffix:!0,locale:A})})]}),s.action==="delete"&&!p.has(s.id)&&e.jsx("button",{className:"restore-button",onClick:()=>f(s),children:"æ¢å¤"})]},s.id))})]})}function V(){const[t,a]=i.useState(!0),{list:n,fetchBookmarks:r}=E();i.useEffect(()=>{(async()=>{a(!0),await r(),a(!1)})()},[]);const[o,m]=i.useState(!1),[p,u]=i.useState(null),x=l=>{navigator.clipboard.writeText(l).then(()=>{u({type:"success",message:"URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿"})}).catch(()=>{u({type:"error",message:"å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶"})})},f=async l=>{try{const c=Date.now()+Math.floor(Math.random()*1e3),b={...l,id:c,create_at:new Date().toISOString()},{error:C}=await w.from("bookmark").insert([b]).select();if(C)throw C;await S("add",b),u({type:"success",message:"æˆåŠŸæ·»åŠ ä¹¦ç­¾"}),r()}catch(c){console.log(c),u({type:"error",message:"æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•"})}},s=async l=>{try{const{error:c}=await w.from("bookmark").delete().eq("url",l.url);if(c)throw c;await S("delete",l),u({type:"success",message:"æˆåŠŸåˆ é™¤ä¹¦ç­¾"}),r()}catch(c){console.error(c),u({type:"error",message:"åˆ é™¤ä¹¦ç­¾å¤±è´¥"})}},[d,g]=i.useState(!1),[j,y]=i.useState(null),N=l=>{y(l),g(!0)},h=async l=>{try{const{error:c}=await w.from("bookmark").update({name:l.name,category:l.category,icon:l.icon}).eq("url",l.url);if(c)throw c;await S("update",l),u({type:"success",message:"æˆåŠŸæ›´æ–°ä¹¦ç­¾"}),r()}catch(c){console.error(c),u({type:"error",message:"æ›´æ–°ä¹¦ç­¾å¤±è´¥"})}g(!1),y(null)},[v,k]=i.useState(!1),S=async(l,c)=>{try{await w.from("bookmark_history").insert([{action:l,bookmark_id:c.id,bookmark_data:c}])}catch(b){console.error("è®°å½•åŽ†å²å¤±è´¥:",b)}};return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:`tab-button ${v?"":"active"}`,onClick:()=>k(!1),children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsx("button",{className:`tab-button ${v?"active":""}`,onClick:()=>k(!0),children:"æ“ä½œåŽ†å²"})]}),e.jsx("div",{className:"dashboard-content",children:v?e.jsx(W,{onRestore:r,onNotify:u}):e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"add-button",onClick:()=>m(!0),children:[e.jsx("span",{className:"button-icon",children:"+"}),"æ·»åŠ ä¹¦ç­¾"]}),e.jsx("span",{className:"bookmark-count",children:t?"åŠ è½½ä¸­...":`${n.length} ä¸ªä¹¦ç­¾`})]})]}),t?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½ä¹¦ç­¾..."})]}):e.jsx("div",{className:"bookmark-list",children:n.map(l=>e.jsxs("div",{className:"bookmark-item",children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{"data-name":l.name,"data-category":l.category,src:l.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:c=>{c.target.src="/fallback-icon.svg"}})}),e.jsxs("div",{className:"bookmark-info",children:[e.jsx("h3",{children:l.name}),e.jsx("p",{className:"category-tag",children:l.category}),e.jsxs("div",{className:"url-container",children:[e.jsx("a",{href:l.url,target:"_blank",rel:"noopener noreferrer",children:l.url}),e.jsx("button",{className:"copy-button",onClick:c=>{c.preventDefault(),x(l.url)},title:"å¤åˆ¶URL",children:"ðŸ“‹"})]})]}),e.jsxs("div",{className:"bookmark-actions",children:[e.jsx("button",{className:"edit-button",onClick:()=>N(l),title:"ç¼–è¾‘ä¹¦ç­¾",children:"âœï¸"}),e.jsx("button",{className:"delete-button",onClick:()=>s(l),title:"åˆ é™¤ä¹¦ç­¾",children:e.jsx("span",{className:"delete-icon",children:"Ã—"})})]})]},l.url))})]})}),o&&e.jsx(I,{onClose:()=>m(!1),onSubmit:f}),d&&j&&e.jsx(H,{bookmark:j,onClose:()=>{g(!1),y(null)},onSubmit:h}),p&&e.jsx(T,{type:p.type,message:p.message,onClose:()=>u(null)})]})}export{V as default};
