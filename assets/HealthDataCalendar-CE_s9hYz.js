import{j as e}from"./index-DtsIYRIN.js";import{b}from"./vendor-Bu9rO6sl.js";import{Select as Y,Row as L,Col as y,Card as N,Statistic as D,CalendarIcon as R,FireIcon as C,Message as w,Tooltip as F}from"./UIComponents-DyH31Hr6.js";import"./utils-Pd6Wu3Vt.js";/* empty css                     */const I=(a,r)=>{if(a===0||r===0)return 0;const l=4,i=Math.log(r+1)/Math.log(l),p=Math.log(a+1)/Math.log(l);return Math.min(Math.ceil(p/i*4),4)},J=(a,r="apple-health-data.json")=>{const l=JSON.stringify(a,null,2),i=new Blob([l],{type:"application/json"});$(i,r)},U=(a,r="apple-health-data.csv")=>{if(!a||!a.data||!Array.isArray(a.data))throw new Error("无效的数据格式");const l=a.activityTypes||[];let i="Date,RecordCount";l.forEach(o=>{i+=`,${o}`}),i+=`
`,a.data.forEach(o=>{i+=`${o.date},${o.count||0}`,l.forEach(m=>{const v=o.details&&o.details[m]?o.details[m]:0;i+=`,${v}`}),i+=`
`});const p=new Blob([i],{type:"text/csv;charset=utf-8;"});$(p,r)},$=(a,r)=>{const l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=r,document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>{URL.revokeObjectURL(l.href)},100)},z=({data:a})=>{const[r,l]=b.useState("all"),{calendarData:i,years:p,activityTypes:o,stats:m}=b.useMemo(()=>{if(!a||!a.data)return{calendarData:[],years:[],activityTypes:[],stats:{}};const s=[...new Set(a.data.map(t=>new Date(t.date).getFullYear()))].sort(),n={};s.forEach(t=>{n[t]=Array(53).fill().map(()=>Array(7).fill(null));const c=new Date(t,0,1),d=c.getDay(),j=new Date(t,11,31),u=Math.ceil((j-c)/(24*60*60*1e3))+1;for(let h=0;h<u;h++){const f=new Date(t,0,h+1),g=Math.floor((h+d)/7),A=f.getDay();n[t][g]&&(n[t][g][A]={date:f.toISOString().split("T")[0],count:0,details:{}})}}),a.data.forEach(t=>{const c=new Date(t.date),d=c.getFullYear(),j=new Date(d,0,1),u=j.getDay(),h=Math.floor((c-j)/(24*60*60*1e3)),f=Math.floor((h+u)/7),g=c.getDay();n[d]&&n[d][f]&&(n[d][f][g]={date:t.date,count:t.count,details:t.details})});const x={totalDays:a.data.length,totalActivities:a.data.reduce((t,c)=>t+c.count,0),maxDailyActivities:Math.max(...a.data.map(t=>t.count)),averageDailyActivities:Math.round(a.data.reduce((t,c)=>t+c.count,0)/a.data.length)};return{calendarData:n,years:s,activityTypes:["all",...a.activityTypes],stats:x}},[a]),v=s=>s?r==="all"?s.count:s.details[r]||0:0,S=b.useMemo(()=>{let s=0;return p.forEach(n=>{i[n].forEach(x=>{x.forEach(t=>{if(t){const c=v(t);c>s&&(s=c)}})})}),s},[i,p,r]),M=()=>{const s=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];return e.jsx("div",{className:"month-labels",children:s.map((n,x)=>e.jsx("div",{className:"month-label",style:{left:`${x*8.3+2}%`},children:n},n))})},O=()=>{const s=["周日","周一","周二","周三","周四","周五","周六"];return e.jsx("div",{className:"weekday-labels",children:s.map(n=>e.jsx("div",{className:"weekday-label",children:n},n))})},E=s=>e.jsxs("div",{className:"year-calendar",children:[e.jsxs("h3",{children:[s,"年"]}),e.jsxs("div",{className:"calendar-grid",children:[M(),e.jsxs("div",{className:"calendar-body",children:[O(),e.jsx("div",{className:"calendar-cells",children:i[s].map((n,x)=>e.jsx("div",{className:"calendar-week",children:n.map((t,c)=>{const d=v(t),j=I(d,S),u=t&&r==="StepCount"?t.details.StepCount||0:t&&t.stepCount||0;let h=t?`${t.date}: ${d} 活动`:"无数据";return t&&u>0&&(h=r==="StepCount"?`${t.date}: ${Math.round(u)} 步`:`${t.date}: ${d} 活动 (${Math.round(u)} 步)`),e.jsx(F,{title:h,children:e.jsx("div",{className:`calendar-day intensity-${j}`,"data-date":t?t.date:""})},`${s}-w${x}-d${c}`)})},`${s}-w${x}`))})]})]})]},s),T=()=>{try{J(a,`apple-health-data-${new Date().toISOString().split("T")[0]}.json`)}catch(s){w.error(`导出 JSON 失败: ${s.message}`)}},k=()=>{try{U(a,`apple-health-data-${new Date().toISOString().split("T")[0]}.csv`)}catch(s){w.error(`导出 CSV 失败: ${s.message}`)}};return e.jsxs("div",{className:"health-data-calendar",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("div",{className:"calendar-title",children:e.jsx("h3",{children:"健康数据日历"})}),e.jsxs("div",{className:"calendar-actions",children:[e.jsx(Y,{value:r,onChange:l,options:[{value:"all",label:"所有活动"},...o.map(s=>({value:s,label:s}))]}),e.jsx("button",{className:"export-button",onClick:T,style:{marginLeft:"10px"},children:"导出 JSON"}),e.jsx("button",{className:"export-button",onClick:k,style:{marginLeft:"10px"},children:"导出 CSV"})]})]}),e.jsxs(L,{gutter:16,className:"stats-cards",children:[e.jsx(y,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"记录天数",value:m.totalDays,prefix:e.jsx(R,{}),suffix:"天"})})}),e.jsx(y,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"总活动数",value:m.totalActivities,prefix:e.jsx(C,{})})})}),e.jsx(y,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"单日最高活动",value:m.maxDailyActivities,prefix:e.jsx(C,{})})})}),e.jsx(y,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"日均活动",value:m.averageDailyActivities,prefix:e.jsx(C,{})})})})]}),e.jsxs("div",{className:"calendar-legend",children:[e.jsx("span",{children:"活动频率: "}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-0"}),e.jsx("span",{children:"无"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-1"}),e.jsx("span",{children:"低"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-2"}),e.jsx("span",{children:"中"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-3"}),e.jsx("span",{children:"高"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-4"}),e.jsx("span",{children:"很高"})]})]})]}),p.map(s=>E(s))]})};export{z as default};
