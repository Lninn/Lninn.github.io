import{j as e}from"./index-BtK_pdOW.js";import{b as f}from"./vendor-D6FSTBK7.js";import{C as v}from"./index-AhqOAm9n.js";import{R as T,C as d,S as y}from"./Col-C2k8XbvK.js";import{S as C}from"./index-BrCmvIcs.js";import"./utils-B-ph8sPT.js";const $=({data:o})=>{const[r,p]=f.useState(null),S=f.useCallback(t=>{if(!t||t.length<2)return null;const m=t.length,n=t.map((a,b)=>b),i=t.map(a=>a.value);let s=0,c=0,h=0,u=0;for(let a=0;a<m;a++)s+=n[a],c+=i[a],h+=n[a]*i[a],u+=n[a]*n[a];const x=m*u-s*s;if(x===0)return{overall:0,direction:"稳定",recentValues:{last7Days:t.slice(-7).map(a=>a.value),last30Days:t.slice(-30).map(a=>a.value)},recentDates:{last7Days:t.slice(-7).map(a=>a.date),last30Days:t.slice(-30).map(a=>a.date)}};const j=(m*h-s*c)/x,D=Math.abs(j)/(Math.max(...i)-Math.min(...i)||1);return{overall:j,strength:D,direction:D<.01?"稳定":j>0?"上升":"下降",recentValues:{last7Days:t.slice(-7).map(a=>a.value),last30Days:t.slice(-30).map(a=>a.value)},recentDates:{last7Days:t.slice(-7).map(a=>a.date),last30Days:t.slice(-30).map(a=>a.date)}}},[]),l=f.useMemo(()=>{if(!o||!o.data||!Array.isArray(o.data))return null;const t={totalDays:o.data.length,totalRecords:0,activitySummary:{},trends:{},activityTypes:o.activityTypes||[]};if([...o.data].sort((i,s)=>new Date(i.date)-new Date(s.date)).forEach(i=>{t.totalRecords+=i.count||0,i.details&&Object.entries(i.details).forEach(([s,c])=>{t.activitySummary[s]||(t.activitySummary[s]={total:0,days:0,max:0,min:1/0,values:[]}),c>0&&(t.activitySummary[s].total+=c,t.activitySummary[s].days+=1,t.activitySummary[s].max=Math.max(t.activitySummary[s].max,c),t.activitySummary[s].min=Math.min(t.activitySummary[s].min,c),t.activitySummary[s].values.push({date:i.date,value:c}))})}),Object.keys(t.activitySummary).forEach(i=>{const s=t.activitySummary[i];if(s.days>0&&(s.average=s.total/s.days),s.min===1/0&&(s.min=0),s.values.length>1){const c=S(s.values);t.trends[i]=c}}),!r&&t.activityTypes.length>0){const i=t.activityTypes.find(s=>s.includes("Step")||s.includes("步数"));p(i||t.activityTypes[0])}const n=Object.keys(t.activitySummary);if(!r&&n.length>0){const i=n.find(s=>s.toLowerCase().includes("step")||s.toLowerCase().includes("步数"));setTimeout(()=>{p(i||n[0])},0)}return t},[o,r,S]),w=f.useCallback(t=>{if(!t)return null;let m,n;return t.direction==="上升"?(m=t.strength>.05?"⬆️":"↗️",n="#52c41a"):t.direction==="下降"?(m=t.strength>.05?"⬇️":"↘️",n="#f5222d"):(m="→",n="#1890ff"),e.jsxs("span",{style:{color:n,marginLeft:"5px"},children:[m," ",t.direction,t.strength>.05&&" (显著)"]})},[]),g=(t,m,n=275)=>{if(!t||t.length<2)return null;const i=Math.max(...t),s=Math.min(...t),c=i-s||1;return e.jsx("div",{className:"simple-chart",style:{height:`${n}px`},children:t.map((h,u)=>{const x=(h-s)/c*100;return e.jsx("div",{className:"chart-bar",style:{height:`${x}%`,backgroundColor:"#1890ff"},title:`${m[u]}: ${h}`},u)})})};return l?e.jsxs("div",{className:"data-analysis",children:[e.jsxs("div",{className:"analysis-header",children:[e.jsx("h3",{children:"数据分析"}),e.jsx(C,{value:r,onChange:p,options:[...l.activityTypes.map(t=>({value:t,label:t}))],placeholder:"选择活动类型",style:{width:"200px"}})]}),e.jsxs(T,{children:[e.jsx(d,{style:{width:"50%"},children:e.jsx(v,{children:e.jsx(y,{title:"总天数",value:l.totalDays,suffix:"天"})})}),e.jsx(d,{style:{width:"50%"},children:e.jsx(v,{children:e.jsx(y,{title:"总记录数",value:l.totalRecords,suffix:"条"})})})]}),r&&l.activitySummary[r]&&e.jsxs("div",{className:"selected-activity-analysis",children:[e.jsxs("h4",{style:{marginTop:"20px"},children:[r," 分析",l.trends[r]&&w(l.trends[r])]}),e.jsxs(v,{style:{marginBottom:"20px"},children:[e.jsxs(T,{children:[e.jsx(d,{style:{width:"25%"},children:e.jsx(y,{title:"总计",value:l.activitySummary[r].total.toFixed(2)})}),e.jsx(d,{style:{width:"25%"},children:e.jsx(y,{title:"平均值",value:l.activitySummary[r].average.toFixed(2)})}),e.jsx(d,{style:{width:"25%"},children:e.jsx(y,{title:"最大值",value:l.activitySummary[r].max.toFixed(2)})}),e.jsx(d,{style:{width:"25%"},children:e.jsx(y,{title:"记录天数",value:l.activitySummary[r].days,suffix:"天"})})]}),l.trends[r]&&e.jsxs("div",{className:"trend-charts",children:[e.jsx("h5",{children:"最近7天趋势"}),g(l.trends[r].recentValues.last7Days,l.trends[r].recentDates.last7Days),e.jsx("h5",{children:"最近30天趋势"}),g(l.trends[r].recentValues.last30Days,l.trends[r].recentDates.last30Days)]})]})]})]}):e.jsx("div",{children:"无数据可分析"})};export{$ as default};
