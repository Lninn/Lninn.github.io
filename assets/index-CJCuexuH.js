import{j as m}from"./index-CvC0IVlO.js";import{b as l}from"./vendor-D6FSTBK7.js";import F from"./TimerHeader-BuQuFDqT.js";import O from"./ModeIndicator-De52GzXo.js";import M from"./TimerDisplay-BN5Q0iiv.js";import C from"./TimerControls-BtyyZB7K.js";import B from"./SettingsPanel-BkDZr9di.js";import L from"./TimerTips-C6zO1Dk6.js";import P from"./RecordsPanel-DSoVCCBz.js";import J from"./GoalProgress-Bpjm0ahy.js";import{M as b}from"./index-Cw3Sa-D2.js";import"./utils-B-ph8sPT.js";import"./SettingsIcon-CDfNfTGK.js";import"./RecordButton-D8nFj845.js";function q(i,d){const[u,p]=l.useState(!1),[t,w]=l.useState("focus"),[n,a]=l.useState(i.focusTime*60),[o,c]=l.useState({...i,soundOption:i.soundOption||"bell"}),[f,v]=l.useState(1),[r,g]=l.useState(null),[T,S]=l.useState(0),y=l.useRef(null),[h,k]=l.useState(!1);l.useEffect(()=>{const e={bell:"/sounds/bell.mp3",complete:"/sounds/complete.mp3",meditation:"/sounds/meditation-bell.mp3"};return y.current=new Audio(e[o.soundOption]),()=>{y.current&&(y.current.pause(),y.current=null)}},[o.soundOption]),l.useEffect(()=>{u&&t==="focus"&&!r&&g(new Date)},[u,t,r]),l.useEffect(()=>{"Notification"in window&&(Notification.permission==="granted"?k(!0):Notification.permission!=="denied"&&Notification.requestPermission().then(e=>{k(e==="granted")}))},[]),l.useEffect(()=>{let e=null;if(u&&n>0)e=setInterval(()=>{if(a(n-1),t==="focus"&&S(s=>s+1/60),n===30){const s=new Audio("/sounds/reminder.mp3");s.volume=o.volume||.5,s.play()}},1e3);else if(u&&n===0){if(y.current&&(y.current.volume=o.volume||1,y.current.play()),h){const s=t==="focus"?"专注时间结束！":t==="break"?"休息时间结束！":"长休息时间结束！",R=t==="focus"?"休息一下吧！":"准备开始新的专注时间";new Notification(s,{body:R,icon:"/favicon.ico"})}if(t==="focus"){const s=f+1;v(s),s>1&&(s-1)%o.longBreakInterval===0?(w("longBreak"),a(o.longBreakTime*60)):(w("break"),a(o.breakTime*60))}else{if(d&&r){const s={focusTime:Math.round(T),cycles:f,mode:t,duration:Math.round((new Date-r)/1e3/60)};d(s),g(null),S(0)}t==="break"&&f===2?v(3):t==="break"&&f===3&&v(4),w("focus"),a(o.focusTime*60)}clearInterval(e),e=null}return()=>clearInterval(e)},[u,n,t,f,o,h,d,r,T]);const x=e=>{const s=Math.floor(e/60),R=e%60;return`${s.toString().padStart(2,"0")}:${R.toString().padStart(2,"0")}`},N=()=>{const e=t==="focus"?o.focusTime*60:t==="break"?o.breakTime*60:o.longBreakTime*60;return(e-n)/e*100},j=()=>{p(!u)},D=()=>{p(!1),w("focus"),a(o.focusTime*60),g(null),S(0),t==="focus"&&r&&T>0&&d&&d({focusTime:Math.round(T),cycles:f,mode:t,completed:!1,startTime:r,endTime:new Date})},E=e=>{c(e),u||(t==="focus"?a(e.focusTime*60):t==="break"?a(e.breakTime*60):t==="longBreak"&&a(e.longBreakTime*60))},I=()=>{"Notification"in window&&Notification.permission!=="denied"&&Notification.requestPermission().then(e=>{k(e==="granted")})};return l.useEffect(()=>{const e=()=>{const R={mode:t,timeLeft:n,cycles:f,totalFocusTime:T,isRunning:!1,timestamp:new Date().toISOString()};localStorage.setItem("reading-timer-state",JSON.stringify(R))},s=setInterval(e,5e3);return window.addEventListener("beforeunload",e),()=>{clearInterval(s),window.removeEventListener("beforeunload",e)}},[t,n,f,T]),l.useEffect(()=>{const e=localStorage.getItem("reading-timer-state");if(console.log(e),e)try{const s=JSON.parse(e),R=new Date(s.timestamp);new Date-R<30*60*1e3?(w(s.mode),a(s.timeLeft),v(s.cycles),S(s.totalFocusTime)):localStorage.removeItem("reading-timer-state")}catch(s){console.error("恢复计时器状态失败",s),localStorage.removeItem("reading-timer-state")}},[]),{isRunning:u,mode:t,timeLeft:n,settings:o,cycles:f,totalFocusTime:T,formatTime:x,calculateProgress:N,toggleTimer:j,resetTimer:D,updateSettings:E,notificationsEnabled:h,requestNotificationPermission:I}}function A(){const[i,d]=l.useState(()=>{const n=localStorage.getItem("reading-timer-records");return n?JSON.parse(n):[]});return l.useEffect(()=>{localStorage.setItem("reading-timer-records",JSON.stringify(i))},[i]),{records:i,addRecord:n=>{const a={...n,id:Date.now(),timestamp:new Date().toISOString()};d(o=>[a,...o])},clearRecords:()=>{window.confirm("确定要清除所有阅读记录吗？此操作不可恢复。")&&d([])},deleteRecord:n=>{d(a=>a.filter(o=>o.id!==n))},getStats:()=>{if(i.length===0)return{totalFocusTime:0,totalSessions:0,totalCycles:0,averageFocusTime:0,lastWeekFocusTime:0,todayFocusTime:0};const n=i.reduce((r,g)=>r+(g.focusTime||0),0),a=new Date,o=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime(),c=new Date(o-a.getDay()*864e5).getTime(),f=i.filter(r=>new Date(r.timestamp).getTime()>=o).reduce((r,g)=>r+(g.focusTime||0),0),v=i.filter(r=>new Date(r.timestamp).getTime()>=c).reduce((r,g)=>r+(g.focusTime||0),0);return{totalFocusTime:n,totalSessions:i.length,totalCycles:i.reduce((r,g)=>r+(g.cycles||0),0),averageFocusTime:Math.round(n/i.length),todayFocusTime:f,lastWeekFocusTime:v}}}}function se(){const[i,d]=l.useState(!1),[u,p]=l.useState(!1),{records:t,addRecord:w,clearRecords:n,deleteRecord:a,getStats:o}=A(),c=q({focusTime:25,breakTime:5,longBreakTime:15,longBreakInterval:4,soundOption:"bell",volume:1,dailyGoal:120},w),f=o(),v=()=>{d(!i),c.isRunning&&!i&&c.toggleTimer(),p(!1)},r=()=>{p(!u),d(!1)},g=T=>{c.updateSettings(T),d(!1)};return l.useEffect(()=>{const T=S=>{S.code==="Space"&&!i&&!u&&(S.preventDefault(),c.toggleTimer()),S.code==="KeyR"&&!i&&!u&&c.resetTimer(),S.code==="Escape"&&(i&&d(!1),u&&p(!1))};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[c,i,u]),m.jsxs("div",{className:"reading-timer-container",children:[m.jsxs("div",{className:"timer-layout",children:[m.jsx("div",{className:"timer-main",children:m.jsxs("div",{className:"timer-card",children:[m.jsx(F,{onSettingsClick:v,onRecordsClick:r}),m.jsx(O,{mode:c.mode,cycles:c.cycles}),m.jsx(M,{timeText:c.formatTime(c.timeLeft),progress:c.calculateProgress()}),m.jsx(C,{isRunning:c.isRunning,onToggle:c.toggleTimer,onReset:c.resetTimer})]})}),m.jsxs("div",{className:"timer-sidebar",children:[m.jsx(J,{current:f.todayFocusTime||0,goal:c.settings.dailyGoal}),m.jsx(L,{})]})]}),m.jsx(b,{isOpen:i,onClose:()=>d(!1),title:"计时器设置",size:"md",children:m.jsx(B,{settings:c.settings,onCancel:()=>d(!1),onApply:g})}),m.jsx(b,{isOpen:u,onClose:()=>p(!1),title:"阅读记录",size:"lg",children:m.jsx(P,{records:t,stats:f,onClear:n,onDelete:a,onClose:()=>p(!1)})}),m.jsx("div",{className:"keyboard-shortcuts",children:m.jsx("p",{children:"快捷键: 空格键 = 开始/暂停, R = 重置, ESC = 关闭面板"})})]})}export{se as default};
