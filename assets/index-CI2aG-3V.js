import{j as e,s as v,E as w}from"./index-B6TE9ouq.js";import{b as n}from"./vendor-C_ovgAfI.js";import{b}from"./bookmark-DO9xnW2a.js";import"./utils-CWHH1IbV.js";function C({list:i,searchTerm:l,category:c}){const u=async a=>{try{await v.from("bookmark_views").insert([{category:c,url:a}])}catch(r){console.error("Failed to record view:",r)}},k=(a,r)=>r?a.split(new RegExp(`(${r})`,"gi")).map((t,h)=>t.toLowerCase()===r.toLowerCase()?e.jsx("span",{className:"highlight",children:t},h):t):a;return e.jsx("ul",{className:"bookmark-list",children:i.map(a=>e.jsx("li",{className:"bookmark-item",children:e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"bookmark-link",onClick:()=>u(a.url),children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{"data-name":a.name,"data-category":a.category,src:a.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:r=>{r.target.src="/fallback-icon.svg"}})}),e.jsx("div",{className:"bookmark-content",children:e.jsx("div",{className:"bookmark-name",children:k(a.name,l)})})]})},a.name))})}function M(){const[i,l]=n.useState(!0),[c,u]=n.useState(null),[k,a]=n.useState({list:[],viewsMap:new Map}),[r,m]=n.useState(""),[t,h]=n.useState("全部");n.useEffect(()=>{async function s(){try{const o=await b.fetchBookmarksWithViews();a(o)}catch(o){u(o.message)}finally{l(!1)}}s()},[]);const{list:d,viewsMap:j}=k,N=n.useMemo(()=>["全部",...new Set(d.map(([s])=>s))],[d]),x=n.useMemo(()=>!r&&t==="全部"?d:d.map(([s,o])=>{if(t!=="全部"&&s!==t)return[s,[]];const g=o.filter(p=>{const f=r.toLowerCase();return p.name.toLowerCase().includes(f)||p.url.toLowerCase().includes(f)});return[s,g]}).filter(([,s])=>s.length>0),[d,r,t]);return i?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"正在加载书签..."})]}):c?e.jsxs("div",{className:"error-state",children:[e.jsxs("p",{children:["加载失败: ",c]}),e.jsx("button",{onClick:()=>window.location.reload(),children:"重试"})]}):e.jsxs("div",{className:"bookmark-container",children:[e.jsxs("div",{className:"bookmark-header",children:[e.jsxs("div",{className:"header-top",children:[e.jsx("h1",{children:"我的书签"}),e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("span",{className:"search-icon",children:"🔍"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"搜索书签...",value:r,onChange:s=>m(s.target.value)}),r&&e.jsx("button",{className:"clear-search",onClick:()=>m(""),title:"清除搜索",children:"×"})]})]}),e.jsxs("div",{className:"category-filter-container",children:[e.jsx("span",{className:"filter-label",children:"分类筛选:"}),e.jsx("div",{className:"category-filter",children:N.map(s=>e.jsx("button",{className:`category-filter-btn ${t===s?"active":""}`,onClick:()=>{h(t===s?"全部":s)},children:s},s))})]})]}),e.jsx("section",{className:"bookmark-grid",children:x.length>0?x.map(([s,o])=>e.jsx(w,{showDetails:!1,children:e.jsx(y,{name:s,data:o,searchTerm:r,viewCount:j.get(s)||0})},s)):e.jsxs("div",{className:"no-results",children:[e.jsx("p",{children:"没有找到匹配的书签"}),e.jsx("button",{className:"reset-search",onClick:()=>{m(""),h("全部")},children:"重置搜索"})]})})]})}function y({name:i,data:l,searchTerm:c}){return e.jsxs("div",{className:"bookmark-category",children:[e.jsx("h2",{className:"category-title",children:i}),e.jsx(C,{list:l,searchTerm:c,category:i})]})}export{M as default};
