import{j as T}from"./index-BECP9mJ1.js";import{b as c}from"./vendor-D6FSTBK7.js";import j from"./TimerHeader-BWWTPXue.js";import F from"./ModeIndicator-Cer0lv9t.js";import M from"./TimerDisplay-Cdhoav6C.js";import B from"./TimerControls-B4eDT_PI.js";import O from"./SettingsPanel-DpnypBGR.js";import L from"./TimerTips-DgBtLYPf.js";import P from"./RecordsPanel-B_pM7O1s.js";import C from"./GoalProgress-FfCc9xxV.js";import"./utils-B-ph8sPT.js";import"./SettingsIcon-C0PhFbqn.js";import"./RecordButton-D_npoK0_.js";function A(a,m){const[u,y]=c.useState(!1),[s,S]=c.useState("focus"),[n,i]=c.useState(a.focusTime*60),[t,l]=c.useState({...a,soundOption:a.soundOption||"bell"}),[d,R]=c.useState(0),[r,f]=c.useState(null),[g,p]=c.useState(0),w=c.useRef(null);c.useEffect(()=>{const o={bell:"/sounds/bell.mp3",complete:"/sounds/complete.mp3",meditation:"/sounds/meditation-bell.mp3"};return w.current=new Audio(o[t.soundOption]),()=>{w.current&&(w.current.pause(),w.current=null)}},[t.soundOption]),c.useEffect(()=>{u&&s==="focus"&&!r&&f(new Date)},[u,s,r]),c.useEffect(()=>{let o=null;if(u&&n>0)o=setInterval(()=>{if(i(n-1),s==="focus"&&p(e=>e+1/60),n===30){const e=new Audio("/sounds/reminder.mp3");e.volume=t.volume||.5,e.play()}},1e3);else if(u&&n===0){if(w.current&&(w.current.volume=t.volume||1,w.current.play()),k){const e=s==="focus"?"专注时间结束！":s==="break"?"休息时间结束！":"长休息时间结束！",v=s==="focus"?"休息一下吧！":"准备开始新的专注时间";new Notification(e,{body:v,icon:"/favicon.ico"})}if(s==="focus"){const e=d+1;R(e),e%t.longBreakInterval===0?(S("longBreak"),i(t.longBreakTime*60)):(S("break"),i(t.breakTime*60))}else{if(m&&r){const e={focusTime:Math.round(g),cycles:d,mode:s,duration:Math.round((new Date-r)/1e3/60)};m(e),f(null),p(0)}S("focus"),i(t.focusTime*60)}}return()=>clearInterval(o)},[u,n,s,t,d,m,r,g]);const h=o=>{const e=Math.floor(o/60),v=o%60;return`${e.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`},D=()=>{const o=s==="focus"?t.focusTime*60:s==="break"?t.breakTime*60:t.longBreakTime*60;return(o-n)/o*100},I=()=>{y(!u)},E=()=>{if(y(!1),i(s==="focus"?t.focusTime*60:s==="break"?t.breakTime*60:t.longBreakTime*60),r&&g>0&&m){const o={focusTime:Math.round(g),cycles:d,mode:s,duration:Math.round((new Date-r)/1e3/60)};m(o),f(null),p(0)}},N=o=>{l(o),i(s==="focus"?o.focusTime*60:s==="break"?o.breakTime*60:o.longBreakTime*60)},[k,b]=c.useState(!1);c.useEffect(()=>{"Notification"in window&&(Notification.permission==="granted"?b(!0):Notification.permission!=="denied"&&Notification.requestPermission().then(o=>{b(o==="granted")}))},[]),c.useEffect(()=>{let o=null;if(u&&n>0)o=setInterval(()=>{if(i(n-1),s==="focus"&&p(e=>e+1/60),n===30){const e=new Audio("/sounds/reminder.mp3");e.volume=t.volume||.5,e.play()}},1e3);else if(u&&n===0){if(w.current&&(w.current.volume=t.volume||1,w.current.play()),k){const e=s==="focus"?"专注时间结束！":s==="break"?"休息时间结束！":"长休息时间结束！",v=s==="focus"?"休息一下吧！":"准备开始新的专注时间";new Notification(e,{body:v,icon:"/favicon.ico"})}if(s==="focus"){const e=d+1;R(e),e%t.longBreakInterval===0?(S("longBreak"),i(t.longBreakTime*60)):(S("break"),i(t.breakTime*60))}else{if(m&&r){const e={focusTime:Math.round(g),cycles:d,mode:s,duration:Math.round((new Date-r)/1e3/60)};m(e),f(null),p(0)}S("focus"),i(t.focusTime*60)}}return()=>clearInterval(o)},[u,n,s,d,t,k]);const x=()=>{"Notification"in window&&Notification.permission!=="denied"&&Notification.requestPermission().then(o=>{b(o==="granted")})};return c.useEffect(()=>{const o=()=>{const v={mode:s,timeLeft:n,cycles:d,totalFocusTime:g,isRunning:!1,timestamp:new Date().toISOString()};localStorage.setItem("reading-timer-state",JSON.stringify(v))},e=setInterval(o,5e3);return window.addEventListener("beforeunload",o),()=>{clearInterval(e),window.removeEventListener("beforeunload",o)}},[s,n,d,g]),c.useEffect(()=>{const o=localStorage.getItem("reading-timer-state");if(o)try{const e=JSON.parse(o),v=new Date(e.timestamp);new Date-v<30*60*1e3?(S(e.mode),i(e.timeLeft),R(e.cycles),p(e.totalFocusTime)):localStorage.removeItem("reading-timer-state")}catch(e){console.error("恢复计时器状态失败",e),localStorage.removeItem("reading-timer-state")}},[]),{isRunning:u,mode:s,timeLeft:n,settings:t,cycles:d,totalFocusTime:g,formatTime:h,calculateProgress:D,toggleTimer:I,resetTimer:E,updateSettings:N,notificationsEnabled:k,requestNotificationPermission:x}}function J(){const[a,m]=c.useState(()=>{const n=localStorage.getItem("reading-timer-records");return n?JSON.parse(n):[]});return c.useEffect(()=>{localStorage.setItem("reading-timer-records",JSON.stringify(a))},[a]),{records:a,addRecord:n=>{const i={...n,id:Date.now(),timestamp:new Date().toISOString()};m(t=>[i,...t])},clearRecords:()=>{window.confirm("确定要清除所有阅读记录吗？此操作不可恢复。")&&m([])},deleteRecord:n=>{m(i=>i.filter(t=>t.id!==n))},getStats:()=>{if(a.length===0)return{totalFocusTime:0,totalSessions:0,totalCycles:0,averageFocusTime:0,lastWeekFocusTime:0,todayFocusTime:0};const n=a.reduce((r,f)=>r+(f.focusTime||0),0),i=new Date,t=new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime(),l=new Date(t-i.getDay()*864e5).getTime(),d=a.filter(r=>new Date(r.timestamp).getTime()>=t).reduce((r,f)=>r+(f.focusTime||0),0),R=a.filter(r=>new Date(r.timestamp).getTime()>=l).reduce((r,f)=>r+(f.focusTime||0),0);return{totalFocusTime:n,totalSessions:a.length,totalCycles:a.reduce((r,f)=>r+(f.cycles||0),0),averageFocusTime:Math.round(n/a.length),todayFocusTime:d,lastWeekFocusTime:R}}}}function ee(){const[a,m]=c.useState(!1),[u,y]=c.useState(!1),{records:s,addRecord:S,clearRecords:n,deleteRecord:i,getStats:t}=J(),l=A({focusTime:25,breakTime:5,longBreakTime:15,longBreakInterval:4,soundOption:"bell",volume:1,dailyGoal:120},S),d=t(),R=()=>{m(!a),l.isRunning&&l.toggleTimer(),y(!1)},r=()=>{y(!u),m(!1)},f=g=>{l.updateSettings(g),m(!1)};return c.useEffect(()=>{const g=p=>{p.code==="Space"&&!a&&!u&&(p.preventDefault(),l.toggleTimer()),p.code==="KeyR"&&!a&&!u&&l.resetTimer(),p.code==="Escape"&&(a&&m(!1),u&&y(!1))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[l,a,u]),T.jsxs("div",{className:"reading-timer-container",children:[T.jsxs("div",{className:"timer-card",children:[T.jsx(j,{onSettingsClick:R,onRecordsClick:r}),T.jsx(F,{mode:l.mode,cycles:l.cycles}),T.jsx(M,{timeText:l.formatTime(l.timeLeft),progress:l.calculateProgress()}),T.jsx(B,{isRunning:l.isRunning,onToggle:l.toggleTimer,onReset:l.resetTimer}),T.jsx(C,{current:d.todayFocusTime||0,goal:l.settings.dailyGoal}),T.jsx(L,{})]}),a&&T.jsx(O,{settings:l.settings,onCancel:()=>m(!1),onApply:f}),u&&T.jsx(P,{records:s,stats:d,onClear:n,onDelete:i,onClose:()=>y(!1)}),T.jsx("div",{className:"keyboard-shortcuts",children:T.jsx("p",{children:"快捷键: 空格键 = 开始/暂停, R = 重置, ESC = 关闭面板"})})]})}export{ee as default};
