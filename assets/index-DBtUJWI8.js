import{j as r,F as B,f as q,D as G,a as H,u as K,d as Q,t as V,c as W,b as X}from"./index-CGDsmW8e.js";import{b as d}from"./vendor-D6FSTBK7.js";import{D as Y}from"./DraggableNavItem-C_KaYL8K.js";import{M as Z}from"./index-CNVjL9gr.js";import $ from"./DroppableNavList--6xDjLdz.js";import ee from"./NavItemForm-BUHSaqQE.js";import"./utils-B-ph8sPT.js";const ie=()=>{const[f,p]=d.useState([]),[C,g]=d.useState(!0),[I,c]=d.useState(null),[v,h]=d.useState(!1),[O,x]=d.useState(null),[N,b]=d.useState("add"),[w,_]=d.useState([]),[D,P]=d.useState([]),m=async()=>{g(!0);try{const e=await q(!0);p(e)}catch(e){c(e.message)}finally{g(!1)}},A=async()=>{_(G),P(H)};d.useEffect(()=>{m(),A()},[]);const u=(e=null)=>{x({name:"",path:"",icon:"",component:"PlaceholderPage",parent_id:e,is_enabled:!0,order_index:f.length}),b("add"),h(!0)},F=e=>{x({...e}),b("edit"),h(!0)},M=async e=>{try{N==="add"?await W(e):await X(e.id,e),h(!1),m()}catch(n){c(n.message)}},T=async e=>{if(window.confirm("确定要删除此导航项吗？"))try{await Q(e),m()}catch(n){c(n.message),alert(n.message)}},L=async(e,n)=>{try{await V(e,!n),m()}catch(t){c(t.message)}},k=async e=>{const{destination:n,source:t,draggableId:a}=e;if(!n||n.droppableId===t.droppableId&&n.index===t.index)return;const s=a.replace("nav-item-",""),i=z(f,t,n,s);p(i);try{const l=E(i);await K(l)}catch(l){c(l.message),m()}},z=(e,n,t,a)=>{if(n.droppableId===t.droppableId){const o=[...e],[J]=o.splice(n.index,1);return o.splice(t.index,0,J),o.forEach((R,U)=>{R.order_index=U}),o}const s=t.droppableId.replace("nav-list-",""),i=JSON.parse(JSON.stringify(e)),l=S(i,a);if(!l)return e;if(l.parent_id=s==="root"?null:parseInt(s),s==="root")i.splice(t.index,0,l);else{const o=j(i,parseInt(s));o&&(o.children||(o.children=[]),o.children.splice(t.index,0,l))}return y(i),i},S=(e,n)=>{const t=parseInt(n);for(let a=0;a<e.length;a++){if(e[a].id===t){const[s]=e.splice(a,1);return s}if(e[a].children&&e[a].children.length>0){const s=S(e[a].children,n);if(s)return s}}return null},j=(e,n)=>{for(const t of e){if(t.id===n)return t;if(t.children&&t.children.length>0){const a=j(t.children,n);if(a)return a}}return null},y=e=>{e.forEach((n,t)=>{n.order_index=t,n.children&&n.children.length>0&&y(n.children)})},E=(e,n=[])=>(e.forEach((t,a)=>{const s={id:t.id,order_index:a};n.push(s),t.children&&t.children.length>0&&E(t.children,n)}),n);return r.jsxs("div",{className:"nav-config-page",children:[r.jsxs("div",{className:"nav-config-header",children:[r.jsx("h1",{children:"导航配置"}),r.jsxs("button",{className:"nav-config-add-btn",onClick:()=>u(),children:[r.jsx(B,{size:18}),"添加导航项"]})]}),I&&r.jsxs("div",{className:"nav-config-error",children:[I,r.jsx("button",{onClick:()=>c(null),children:"关闭"})]}),C?r.jsx("div",{className:"nav-config-loading",children:"加载中..."}):f.length===0?r.jsxs("div",{className:"nav-config-empty",children:[r.jsx("p",{children:"暂无导航项"}),r.jsx("button",{onClick:()=>u(),children:"添加导航项"})]}):r.jsx("div",{className:"nav-config-container",children:r.jsx(Y,{onDragEnd:k,children:r.jsx($,{items:f,droppableId:"root",onAddChild:u,onEdit:F,onToggleStatus:L,onDelete:T})})}),v&&r.jsx(Z,{isOpen:v,onClose:()=>h(!1),title:N==="add"?"添加导航项":"编辑导航项",size:"md",children:r.jsx(ee,{item:O,onSubmit:M,onCancel:()=>h(!1),availableIcons:w,availableComponents:D})})]})};export{ie as default};
