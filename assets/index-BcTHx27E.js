import{j as e,s as u,r as m,E as f}from"./index-E7RIDEMB.js";function x({list:t,searchTerm:o,category:r}){const c=async a=>{try{await u.from("bookmark_views").insert([{category:r,url:a}])}catch(i){console.error("Failed to record view:",i)}},n=(a,i)=>i?a.split(new RegExp(`(${i})`,"gi")).map((s,d)=>s.toLowerCase()===i.toLowerCase()?e.jsx("span",{className:"highlight",children:s},d):s):a;return e.jsx("ul",{className:"bookmark-list",children:t.map(a=>e.jsx("li",{className:"bookmark-item",children:e.jsxs("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"bookmark-link",onClick:()=>c(a.url),children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{src:a.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:i=>{i.target.src="/fallback-icon.svg"}})}),e.jsx("div",{className:"bookmark-content",children:e.jsx("div",{className:"bookmark-name",children:n(a.name,o)})})]})},a.name))})}function g(t){var o=t,r={};for(const a of o)if("category"in a){var c=a.category;c in r?r[c].push(a):r[c]=[a]}var n=Object.entries(r);return v(n,!1)}function v(t,o=!0){return t.sort((r,c)=>o?r[0][0].localeCompare(c[0][0]):c[0][0].localeCompare(r[0][0]))}function w(t){let o="pending",r,c=t.then(n=>{o="success",r=n},n=>{o="error",r=n});return{read(){if(o==="pending")throw c;if(o==="error")throw r;if(o==="success")return r}}}const j=w(N());async function N(){const{data:t,error:o}=await u.from("bookmark").select("*");if(o)throw o;const{data:r,error:c}=await u.from("category_views").select("*");if(c)throw c;const n=new Map((r==null?void 0:r.map(l=>[l.category,l.view_count]))||[]);return{list:g(t).sort((l,s)=>{const d=n.get(l[0])||0;return(n.get(s[0])||0)-d}),viewsMap:n}}function y(){const{list:t,viewsMap:o}=j.read(),[r,c]=m.useState(""),[n,a]=m.useState("全部"),i=m.useMemo(()=>["全部",...new Set(t.map(([s])=>s))],[t]),l=m.useMemo(()=>!r&&n==="全部"?t:t.map(([s,d])=>{if(n!=="全部"&&s!==n)return[s,[]];const h=d.filter(k=>{const p=r.toLowerCase();return k.name.toLowerCase().includes(p)||k.url.toLowerCase().includes(p)});return[s,h]}).filter(([,s])=>s.length>0),[t,r,n]);return e.jsxs("div",{className:"bookmark-container",children:[e.jsxs("div",{className:"bookmark-header",children:[e.jsxs("div",{className:"header-top",children:[e.jsx("h1",{children:"我的书签"}),e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("span",{className:"search-icon",children:"🔍"}),e.jsx("input",{type:"text",className:"search-input",placeholder:"搜索书签...",value:r,onChange:s=>c(s.target.value)}),r&&e.jsx("button",{className:"clear-search",onClick:()=>c(""),title:"清除搜索",children:"×"})]})]}),e.jsxs("div",{className:"category-filter-container",children:[e.jsx("span",{className:"filter-label",children:"分类筛选:"}),e.jsx("div",{className:"category-filter",children:i.map(s=>e.jsx("button",{className:`category-filter-btn ${n===s?"active":""}`,onClick:()=>{a(n===s?"全部":s)},children:s},s))})]})]}),e.jsx("section",{className:"bookmark-grid",children:l.length>0?l.map(([s,d])=>e.jsx(f,{showDetails:!1,children:e.jsx(b,{name:s,data:d,searchTerm:r,viewCount:o.get(s)||0})},s)):e.jsxs("div",{className:"no-results",children:[e.jsx("p",{children:"没有找到匹配的书签"}),e.jsx("button",{className:"reset-search",onClick:()=>{c(""),a("全部")},children:"重置搜索"})]})})]})}function b({name:t,data:o,searchTerm:r}){return e.jsxs("div",{className:"bookmark-category",children:[e.jsx("h2",{className:"category-title",children:t}),e.jsx(x,{list:o,searchTerm:r,category:t})]})}export{y as default};
