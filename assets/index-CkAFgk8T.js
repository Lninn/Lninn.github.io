import{j as r,L as f,s as i}from"./index-BFytwfpB.js";import{r as d}from"./vendor-DaomY4Gh.js";import{f as _}from"./utils-DVSSZgyS.js";import{z as b}from"./zh-CN-C-u-YLiA.js";function v({onRestore:n,onNotify:e}){const[o,h]=d.useState([]),[p,l]=d.useState(!1),[x,u]=d.useState(new Set),m=async()=>{l(!0);try{const{data:s}=await i.from("bookmark_history").select("restored_from_id").not("restored_from_id","is",null),a=new Set((s==null?void 0:s.map(k=>k.restored_from_id))||[]);u(a);const{data:c,error:t}=await i.from("bookmark_history").select("*").order("created_at",{ascending:!1});if(t)throw t;h(c)}catch(s){console.error("获取历史记录失败:",s),e==null||e({type:"error",message:"获取历史记录失败"})}finally{l(!1)}};d.useEffect(()=>{m()},[]);const j=async s=>{try{const{bookmark_data:a}=s,{error:c}=await i.from("bookmark").insert([a]);if(c)throw c;const{error:t}=await i.from("bookmark_history").insert([{action:"restore",bookmark_id:a.id,bookmark_data:a,restored_from_id:s.id}]);if(t)throw t;e==null||e({type:"success",message:"书签恢复成功"}),n==null||n(),m()}catch(a){console.error("恢复书签失败:",a),e==null||e({type:"error",message:"恢复书签失败"})}};return p?r.jsx(f,{text:"正在加载历史记录..."}):!o||o.length===0?r.jsx("div",{className:"list-section",children:r.jsxs("div",{className:"empty-state",children:[r.jsx("p",{children:"暂无历史记录"}),r.jsx("p",{className:"empty-tip",children:"操作书签后将显示在这里"})]})}):r.jsxs("div",{className:"list-section",children:[r.jsxs("div",{className:"section-header",children:[r.jsx("h2",{children:"操作历史"}),r.jsxs("span",{className:"item-count",children:[o.length," 条记录"]})]}),r.jsx("div",{className:"history-list",children:o.map(s=>r.jsxs("div",{className:"history-item",children:[r.jsxs("div",{className:"history-content",children:[r.jsxs("span",{className:"history-action",children:[s.action==="add"&&"添加了",s.action==="delete"&&"删除了",s.action==="update"&&"修改了",s.action==="restore"&&"恢复了"]}),r.jsx("span",{className:"history-name",children:s.bookmark_data.name}),r.jsx("span",{className:"history-time",children:_(new Date(s.created_at),{addSuffix:!0,locale:b})})]}),s.action==="delete"&&!x.has(s.id)&&r.jsx("button",{className:"restore-button",onClick:()=>j(s),children:"恢复"})]},s.id))})]})}export{v as default};
