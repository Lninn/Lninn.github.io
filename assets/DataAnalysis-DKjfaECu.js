import{j as e}from"./index-CxKPNSvz.js";import{b as f}from"./vendor-Bu9rO6sl.js";import{Select as C,Row as g,Col as m,Card as v,Statistic as o}from"./UIComponents-LSnR0qmT.js";import"./utils-Pd6Wu3Vt.js";/* empty css                     */const E=({data:y})=>{const[l,u]=f.useState(null),S=f.useCallback(t=>{if(!t||t.length<2)return null;const n=t.length,c=t.map((a,b)=>b),i=t.map(a=>a.value);let s=0,d=0,h=0,x=0;for(let a=0;a<n;a++)s+=c[a],d+=i[a],h+=c[a]*i[a],x+=c[a]*c[a];const j=n*x-s*s;if(j===0)return{overall:0,direction:"稳定",recentValues:{last7Days:t.slice(-7).map(a=>a.value),last30Days:t.slice(-30).map(a=>a.value)},recentDates:{last7Days:t.slice(-7).map(a=>a.date),last30Days:t.slice(-30).map(a=>a.date)}};const p=(n*h-s*d)/j,w=Math.abs(p)/(Math.max(...i)-Math.min(...i)||1);return{overall:p,strength:w,direction:w<.01?"稳定":p>0?"上升":"下降",recentValues:{last7Days:t.slice(-7).map(a=>a.value),last30Days:t.slice(-30).map(a=>a.value)},recentDates:{last7Days:t.slice(-7).map(a=>a.date),last30Days:t.slice(-30).map(a=>a.date)}}},[]),r=f.useMemo(()=>{if(!y||!y.data||!Array.isArray(y.data))return null;const t={totalDays:y.data.length,totalRecords:0,activitySummary:{},trends:{},activityTypes:y.activityTypes||[]};if([...y.data].sort((i,s)=>new Date(i.date)-new Date(s.date)).forEach(i=>{t.totalRecords+=i.count||0,i.details&&Object.entries(i.details).forEach(([s,d])=>{t.activitySummary[s]||(t.activitySummary[s]={total:0,days:0,max:0,min:1/0,values:[]}),d>0&&(t.activitySummary[s].total+=d,t.activitySummary[s].days+=1,t.activitySummary[s].max=Math.max(t.activitySummary[s].max,d),t.activitySummary[s].min=Math.min(t.activitySummary[s].min,d),t.activitySummary[s].values.push({date:i.date,value:d}))})}),Object.keys(t.activitySummary).forEach(i=>{const s=t.activitySummary[i];if(s.days>0&&(s.average=s.total/s.days),s.min===1/0&&(s.min=0),s.values.length>1){const d=S(s.values);t.trends[i]=d}}),!l&&t.activityTypes.length>0){const i=t.activityTypes.find(s=>s.includes("Step")||s.includes("步数"));u(i||t.activityTypes[0])}const c=Object.keys(t.activitySummary);if(!l&&c.length>0){const i=c.find(s=>s.toLowerCase().includes("step")||s.toLowerCase().includes("步数"));setTimeout(()=>{u(i||c[0])},0)}return t},[y,l,S]),D=f.useCallback(t=>{if(!t)return null;let n,c;return t.direction==="上升"?(n=t.strength>.05?"⬆️":"↗️",c="#52c41a"):t.direction==="下降"?(n=t.strength>.05?"⬇️":"↘️",c="#f5222d"):(n="→",c="#1890ff"),e.jsxs("span",{style:{color:c,marginLeft:"5px"},children:[n," ",t.direction,t.strength>.05&&" (显著)"]})},[]),T=(t,n,c=50)=>{if(!t||t.length<2)return null;const i=Math.max(...t),s=Math.min(...t),d=i-s||1;return e.jsx("div",{className:"simple-chart",style:{height:`${c}px`},children:t.map((h,x)=>{const j=(h-s)/d*100;return e.jsx("div",{className:"chart-bar",style:{height:`${j}%`,backgroundColor:"#1890ff"},title:`${n[x]}: ${h}`},x)})})};return r?e.jsxs("div",{className:"data-analysis",children:[e.jsxs("div",{className:"analysis-header",children:[e.jsx("h3",{children:"数据分析"}),e.jsx(C,{value:l,onChange:u,options:[...r.activityTypes.map(t=>({value:t,label:t}))],placeholder:"选择活动类型",style:{width:"200px"}})]}),e.jsxs(g,{children:[e.jsx(m,{style:{width:"50%"},children:e.jsx(v,{children:e.jsx(o,{title:"总天数",value:r.totalDays,suffix:"天"})})}),e.jsx(m,{style:{width:"50%"},children:e.jsx(v,{children:e.jsx(o,{title:"总记录数",value:r.totalRecords,suffix:"条"})})})]}),l&&r.activitySummary[l]&&e.jsxs("div",{className:"selected-activity-analysis",children:[e.jsxs("h4",{style:{marginTop:"20px"},children:[l," 分析",r.trends[l]&&D(r.trends[l])]}),e.jsxs(v,{style:{marginBottom:"20px"},children:[e.jsxs(g,{children:[e.jsx(m,{style:{width:"25%"},children:e.jsx(o,{title:"总计",value:r.activitySummary[l].total.toFixed(2)})}),e.jsx(m,{style:{width:"25%"},children:e.jsx(o,{title:"平均值",value:r.activitySummary[l].average.toFixed(2)})}),e.jsx(m,{style:{width:"25%"},children:e.jsx(o,{title:"最大值",value:r.activitySummary[l].max.toFixed(2)})}),e.jsx(m,{style:{width:"25%"},children:e.jsx(o,{title:"记录天数",value:r.activitySummary[l].days,suffix:"天"})})]}),r.trends[l]&&e.jsxs("div",{className:"trend-charts",children:[e.jsx("h5",{children:"最近7天趋势"}),T(r.trends[l].recentValues.last7Days,r.trends[l].recentDates.last7Days),e.jsx("h5",{children:"最近30天趋势"}),T(r.trends[l].recentValues.last30Days,r.trends[l].recentDates.last30Days)]})]})]}),e.jsx("h4",{style:{marginTop:"20px"},children:"所有活动摘要"}),e.jsx("div",{className:"activity-summary-list",children:Object.entries(r.activitySummary).sort(([,t],[,n])=>n.total-t.total).map(([t,n])=>e.jsxs(v,{style:{marginBottom:"10px",cursor:"pointer"},onClick:()=>u(t),className:l===t?"selected-card":"",children:[e.jsxs("div",{className:"activity-summary-header",children:[e.jsx("h5",{children:t}),r.trends[t]&&D(r.trends[t])]}),e.jsxs(g,{children:[e.jsx(m,{style:{width:"33%"},children:e.jsx(o,{title:"总计",value:n.total.toFixed(2)})}),e.jsx(m,{style:{width:"33%"},children:e.jsx(o,{title:"平均值",value:n.average.toFixed(2)})}),e.jsx(m,{style:{width:"33%"},children:e.jsx(o,{title:"记录天数",value:n.days,suffix:"天"})})]})]},t))})]}):e.jsx("div",{children:"无数据可分析"})};export{E as default};
