import{j as e}from"./index-keaAarXt.js";import{r as C}from"./vendor-DaomY4Gh.js";import{Select as Y,Row as L,Col as g,Card as N,Statistic as D,CalendarIcon as R,FireIcon as b,Message as w,Tooltip as I}from"./UIComponents-CcZVMYMa.js";import"./ErrorBoundary-BrUjeKXY.js";/* empty css                           */import"./utils-DVSSZgyS.js";/* empty css                     */const F=(s,i)=>{if(s===0||i===0)return 0;const r=s/i;return r<=.25?1:r<=.5?2:r<=.75?3:4},J=(s,i="apple-health-data.json")=>{const r=JSON.stringify(s,null,2),c=new Blob([r],{type:"application/json"});$(c,i)},U=(s,i="apple-health-data.csv")=>{if(!s||!s.data||!Array.isArray(s.data))throw new Error("无效的数据格式");const r=s.activityTypes||[];let c="Date,RecordCount";r.forEach(h=>{c+=`,${h}`}),c+=`
`,s.data.forEach(h=>{c+=`${h.date},${h.count||0}`,r.forEach(m=>{const v=h.details&&h.details[m]?h.details[m]:0;c+=`,${v}`}),c+=`
`});const j=new Blob([c],{type:"text/csv;charset=utf-8;"});$(j,i)},$=(s,i)=>{const r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(()=>{URL.revokeObjectURL(r.href)},100)},z=({data:s})=>{const[i,r]=C.useState("HKQuantityTypeIdentifierStepCount"),{calendarData:c,years:j,activityTypes:h,stats:m}=C.useMemo(()=>{if(!s||!s.data)return{calendarData:[],years:[],activityTypes:[],stats:{}};const t=[...new Set(s.data.map(n=>new Date(n.date).getFullYear()))].sort(),l={};t.forEach(n=>{l[n]=Array(53).fill().map(()=>Array(7).fill(null));const a=new Date(n,0,1),o=a.getDay(),p=new Date(n,11,31),f=Math.ceil((p-a)/(24*60*60*1e3))+1;for(let d=0;d<f;d++){const u=new Date(n,0,d+1),y=Math.floor((d+o)/7),A=u.getDay();l[n][y]&&(l[n][y][A]={date:u.toISOString().split("T")[0],count:0,details:{}})}}),s.data.forEach(n=>{const a=new Date(n.date),o=a.getFullYear(),p=new Date(o,0,1),f=p.getDay(),d=Math.floor((a-p)/(24*60*60*1e3)),u=Math.floor((d+f)/7),y=a.getDay();l[o]&&l[o][u]&&(l[o][u][y]={date:n.date,count:n.count,details:n.details})});const x={totalDays:s.data.length,totalActivities:s.data.reduce((n,a)=>n+a.count,0),maxDailyActivities:Math.max(...s.data.map(n=>n.count)),averageDailyActivities:Math.round(s.data.reduce((n,a)=>n+a.count,0)/s.data.length)};return{calendarData:l,years:t,activityTypes:["all",...s.activityTypes],stats:x}},[s]),v=t=>t?i==="all"?t.count:t.details[i]||0:0,S=C.useMemo(()=>{const t={};return j.forEach(l=>{let x=0;c[l].forEach(n=>{n.forEach(a=>{if(a){const o=v(a);o>x&&(x=o)}})}),t[l]=x}),t},[c,j,i]),O=()=>{const t=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];return e.jsx("div",{className:"month-labels",children:t.map((l,x)=>e.jsx("div",{className:"month-label",style:{left:`${x*8.3+2}%`},children:l},l))})},T=()=>{const t=["周日","周一","周二","周三","周四","周五","周六"];return e.jsx("div",{className:"weekday-labels",children:t.map(l=>e.jsx("div",{className:"weekday-label",children:l},l))})},E=t=>{const l=S[t];return e.jsxs("div",{className:"year-calendar",children:[e.jsxs("h3",{children:[t,"年"]}),e.jsxs("div",{className:"calendar-grid",children:[O(),e.jsxs("div",{className:"calendar-body",children:[T(),e.jsx("div",{className:"calendar-cells",children:c[t].map((x,n)=>e.jsx("div",{className:"calendar-week",children:x.map((a,o)=>{const p=v(a),f=F(p,l),d=a&&i==="StepCount"?a.details.StepCount||0:a&&a.stepCount||0;let u=a?`${a.date}: ${p} 活动`:"无数据";return a&&d>0&&(u=i==="StepCount"?`${a.date}: ${Math.round(d)} 步`:`${a.date}: ${p} 活动 (${Math.round(d)} 步)`),e.jsx(I,{title:u,children:e.jsx("div",{className:`calendar-day intensity-${f}`,"data-date":a?a.date:""})},`${t}-w${n}-d${o}`)})},`${t}-w${n}`))})]})]})]},t)},M=()=>{try{J(s,`apple-health-data-${new Date().toISOString().split("T")[0]}.json`)}catch(t){w.error(`导出 JSON 失败: ${t.message}`)}},k=()=>{try{U(s,`apple-health-data-${new Date().toISOString().split("T")[0]}.csv`)}catch(t){w.error(`导出 CSV 失败: ${t.message}`)}};return e.jsxs("div",{className:"health-data-calendar",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("div",{className:"calendar-title",children:e.jsx("h3",{children:"健康数据日历"})}),e.jsxs("div",{className:"calendar-actions",children:[e.jsx(Y,{value:i,onChange:r,options:[{value:"all",label:"所有活动"},...h.map(t=>({value:t,label:t}))]}),e.jsx("button",{className:"export-button",onClick:M,style:{marginLeft:"10px"},children:"导出 JSON"}),e.jsx("button",{className:"export-button",onClick:k,style:{marginLeft:"10px"},children:"导出 CSV"})]})]}),e.jsxs(L,{gutter:16,className:"stats-cards",children:[e.jsx(g,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"记录天数",value:m.totalDays,prefix:e.jsx(R,{}),suffix:"天"})})}),e.jsx(g,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"总活动数",value:m.totalActivities,prefix:e.jsx(b,{})})})}),e.jsx(g,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"单日最高活动",value:m.maxDailyActivities,prefix:e.jsx(b,{})})})}),e.jsx(g,{span:6,children:e.jsx(N,{children:e.jsx(D,{title:"日均活动",value:m.averageDailyActivities,prefix:e.jsx(b,{})})})})]}),e.jsxs("div",{className:"calendar-legend",children:[e.jsx("span",{children:"活动频率: "}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-0"}),e.jsx("span",{children:"无"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-1"}),e.jsx("span",{children:"低"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-2"}),e.jsx("span",{children:"中"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-3"}),e.jsx("span",{children:"高"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-4"}),e.jsx("span",{children:"很高"})]})]})]}),j.map(t=>E(t))]})};export{z as default};
