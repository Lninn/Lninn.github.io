import{c as G,s as w,r as o,j as e}from"./index-BfJxXvsD.js";import{f as J,z as K}from"./zh-CN-ZPh2jKaf.js";const z=G(m=>({list:[],fetchBookmarks:async()=>{const{data:i,error:d}=await w.from("bookmark").select("*").order("create_at",{ascending:!1});if(d){console.error("Failed to fetch bookmark data:",d);return}m({list:i})}}));function Q({onClose:m,onSubmit:i}){const{list:d}=z(),[c,p]=o.useState(""),[u,g]=o.useState({url:"",name:"",category:"",icon:""}),[h,j]=o.useState(!1),[y,r]=o.useState(null),[n,x]=o.useState(null),[b,k]=o.useState(!1),[D,q]=o.useState([]),[N,S]=o.useState(!1),[C,t]=o.useState(!1);o.useEffect(()=>{if(d&&d.length>0){const s=[...new Set(d.map(a=>a.category).filter(Boolean))];q(s)}},[d]),o.useEffect(()=>{const s=a=>{N&&!a.target.closest(".category-select-container")&&S(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[N]);const l=async()=>{if(!(!c||!c.trim())){j(!0),r("å¼€å§‹åˆ†æ"),x(null),k(!1),t(!1);try{r("éªŒè¯URLæ ¼å¼");let s=c;!c.startsWith("http://")&&!c.startsWith("https://")&&(s="https://"+c);const a=s.toLowerCase().replace(/\/$/,"");if(d.some(U=>U.url.toLowerCase().replace(/\/$/,"")===a)){t(!0),x("è¯¥URLå·²å­˜åœ¨äºæ‚¨çš„ä¹¦ç­¾ä¸­"),j(!1);return}r("è·å–ç½‘ç«™å…ƒæ•°æ®");const f=await L(s);r("å¤„ç†åˆ†æç»“æœ"),g({url:s,name:f.title||"",icon:f.icon||"",category:f.suggestedCategory||""}),r("åˆ†æå®Œæˆ"),k(!0)}catch(s){x(`åœ¨"${y}"æ­¥éª¤å¤±è´¥: ${s.message}`)}finally{j(!1)}}},L=async s=>{var a,v,f,U;try{const _="https://api.allorigins.win/get?url="+encodeURIComponent(s),F=await(await fetch(_)).json();if(!F.contents)throw new Error("æ— æ³•è·å–ç½‘ç«™å†…å®¹");const E=new DOMParser().parseFromString(F.contents,"text/html");let A=((a=E.querySelector("title"))==null?void 0:a.textContent)||"";A||(A=((v=E.querySelector('meta[property="og:title"]'))==null?void 0:v.getAttribute("content"))||"");let R="";const O=E.querySelector('link[rel="icon"]')||E.querySelector('link[rel="shortcut icon"]');O&&(R=new URL(O.getAttribute("href"),s).href),R||(R=`https://www.google.com/s2/favicons?domain=${s}`);let T=((f=E.querySelector('meta[name="keywords"]'))==null?void 0:f.getAttribute("content"))||"",W=((U=E.querySelector('meta[name="description"]'))==null?void 0:U.getAttribute("content"))||"",P=$(T+" "+W)||B(new URL(s).hostname);return{title:A||M(s),icon:R,suggestedCategory:P}}catch(_){return console.error("è·å–ç½‘ç«™ä¿¡æ¯å¤±è´¥:",_),H(s)}},$=(s="")=>{const a=s.toLowerCase(),v={æŠ€æœ¯:["programming","developer","coding","ç¼–ç¨‹","å¼€å‘","æŠ€æœ¯"],æ–°é—»:["news","daily","report","æ–°é—»","èµ„è®¯"],è´­ç‰©:["shop","store","buy","price","å•†åŸ","è´­ç‰©"],æ•™è‚²:["learn","course","education","study","æ•™è‚²","å­¦ä¹ "],å¨±ä¹:["game","entertainment","movie","music","æ¸¸æˆ","ç”µå½±","éŸ³ä¹"],ç¤¾äº¤:["social","community","forum","ç¤¾åŒº","è®ºå›"]};for(const[f,U]of Object.entries(v))if(U.some(_=>a.includes(_)))return f;return null},M=s=>{try{const a=new URL(s).hostname;return a.split(".")[0].charAt(0).toUpperCase()+a.split(".")[0].slice(1)}catch{return s}},H=s=>{try{const a=new URL(s).hostname;return{title:M(s),icon:`https://www.google.com/s2/favicons?domain=${s}`,suggestedCategory:B(a)}}catch{throw new Error("æ— æ•ˆçš„URLæ ¼å¼")}},B=s=>{const a={github:"å¼€å‘å·¥å…·",stackoverflow:"å¼€å‘å·¥å…·",youtube:"è§†é¢‘",bilibili:"è§†é¢‘",google:"æœç´¢",baidu:"æœç´¢",zhihu:"ç¤¾äº¤",weibo:"ç¤¾äº¤",twitter:"ç¤¾äº¤",facebook:"ç¤¾äº¤",instagram:"ç¤¾äº¤",amazon:"è´­ç‰©",taobao:"è´­ç‰©",jd:"è´­ç‰©"};for(const[v,f]of Object.entries(a))if(s.includes(v))return f;return"å…¶ä»–"},I=s=>{s.preventDefault();const a=u.url.toLowerCase().replace(/\/$/,"");if(d.some(f=>f.url.toLowerCase().replace(/\/$/,"")===a)){t(!0),x("è¯¥URLå·²å­˜åœ¨äºæ‚¨çš„ä¹¦ç­¾ä¸­");return}i(u),m()};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-bookmark-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"æ·»åŠ æ–°ä¹¦ç­¾"}),e.jsx("button",{className:"close-button",onClick:m,children:"Ã—"})]}),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"ç½‘å€"}),e.jsxs("div",{className:"url-input-container",children:[e.jsx("input",{type:"url",value:c,onChange:s=>p(s.target.value),placeholder:"è¾“å…¥ç½‘ç«™åœ°å€",required:!0}),e.jsx("button",{type:"button",className:"analyze-button",onClick:l,disabled:h||!c,children:"åˆ†æ"})]})]}),h&&e.jsxs("div",{className:"analysis-status",children:[e.jsx("h3",{children:"æ­£åœ¨åˆ†æç½‘ç«™..."}),e.jsx("div",{className:"analysis-steps",children:["å¼€å§‹åˆ†æ","éªŒè¯URLæ ¼å¼","è·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æç»“æœ","åˆ†æå®Œæˆ"].map((s,a)=>e.jsxs("div",{className:`analysis-step ${y===s?"active":""} ${["å¼€å§‹åˆ†æ","éªŒè¯URLæ ¼å¼","è·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æç»“æœ"].indexOf(s)<["å¼€å§‹åˆ†æ","éªŒè¯URLæ ¼å¼","è·å–ç½‘ç«™å…ƒæ•°æ®","å¤„ç†åˆ†æç»“æœ"].indexOf(y)?"complete":""}`,children:[e.jsx("div",{className:"step-indicator",children:a+1}),e.jsx("div",{className:"step-label",children:s})]},a))})]}),C&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:"è¯¥URLå·²å­˜åœ¨äºæ‚¨çš„ä¹¦ç­¾ä¸­"}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šæ‚¨å¯ä»¥åœ¨ä¹¦ç­¾åˆ—è¡¨ä¸­æŸ¥æ‰¾æ­¤ç½‘ç«™ã€‚"})]}),n&&!C&&e.jsxs("div",{className:"analysis-error",children:[e.jsx("p",{children:n}),e.jsx("p",{className:"error-tip",children:"æç¤ºï¼šè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®ï¼Œæˆ–ç¨åå†è¯•ã€‚"})]}),b&&e.jsxs("form",{onSubmit:I,className:"bookmark-form",children:[e.jsx("h3",{children:"ä¹¦ç­¾ä¿¡æ¯"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:u.name,onChange:s=>g(a=>({...a,name:s.target.value})),placeholder:"ä¹¦ç­¾åç§°",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:u.category,onChange:s=>g(a=>({...a,category:s.target.value})),onFocus:()=>S(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»",required:!0}),N&&D.length>0&&e.jsx("div",{className:"category-dropdown",children:D.map((s,a)=>e.jsx("div",{className:`category-option ${u.category===s?"selected":""}`,onClick:()=>{g(v=>({...v,category:s})),S(!1)},children:s},a))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å›¾æ ‡"}),e.jsxs("div",{className:"icon-preview",children:[u.icon&&e.jsx("img",{src:u.icon,alt:"ç½‘ç«™å›¾æ ‡"}),e.jsx("input",{type:"text",value:u.icon,onChange:s=>g(a=>({...a,icon:s.target.value})),placeholder:"å›¾æ ‡URL"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:m,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"submit-button",children:"æ·»åŠ ä¹¦ç­¾"})]})]})]})]})})}function V({bookmark:m,onClose:i,onSubmit:d}){const{list:c}=z(),[p,u]=o.useState({name:m.name,category:m.category}),[g,h]=o.useState([]),[j,y]=o.useState(!1);o.useEffect(()=>{if(c&&c.length>0){const n=[...new Set(c.map(x=>x.category).filter(Boolean))];h(n)}},[c]);const r=n=>{n.preventDefault(),d({...m,...p})};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-bookmark-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"ç¼–è¾‘ä¹¦ç­¾"}),e.jsx("button",{className:"close-button",onClick:i,children:"Ã—"})]}),e.jsx("div",{className:"modal-content",children:e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åç§°"}),e.jsx("input",{type:"text",value:p.name,onChange:n=>u({...p,name:n.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åˆ†ç±»"}),e.jsxs("div",{className:"category-select-container",children:[e.jsx("input",{type:"text",value:p.category,onChange:n=>u({...p,category:n.target.value}),onFocus:()=>y(!0),placeholder:"é€‰æ‹©æˆ–è¾“å…¥æ–°åˆ†ç±»"}),j&&g.length>0&&e.jsx("div",{className:"category-dropdown",children:g.map(n=>e.jsx("div",{className:`category-option ${n===p.category?"selected":""}`,onClick:()=>{u({...p,category:n}),y(!1)},children:n},n))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"cancel-button",onClick:i,children:"å–æ¶ˆ"}),e.jsx("button",{type:"submit",className:"submit-button",children:"ä¿å­˜ä¿®æ”¹"})]})]})})]})})}function X({message:m,type:i="success",onClose:d,duration:c=3e3}){return o.useEffect(()=>{const p=setTimeout(()=>{d()},c);return()=>clearTimeout(p)},[c,d]),e.jsxs("div",{className:`notification notification-${i}`,children:[e.jsx("span",{className:"notification-icon",children:i==="success"?"âœ“":"âœ•"}),e.jsx("span",{className:"notification-message",children:m})]})}function Y({onRestore:m,onNotify:i}){const[d,c]=o.useState([]),[p,u]=o.useState(!1),[g,h]=o.useState(new Set),j=async()=>{u(!0);try{const{data:r}=await w.from("bookmark_history").select("restored_from_id").not("restored_from_id","is",null),n=new Set((r==null?void 0:r.map(k=>k.restored_from_id))||[]);h(n);const{data:x,error:b}=await w.from("bookmark_history").select("*").order("created_at",{ascending:!1});if(b)throw b;c(x)}catch(r){console.error("è·å–å†å²è®°å½•å¤±è´¥:",r),i==null||i({type:"error",message:"è·å–å†å²è®°å½•å¤±è´¥"})}finally{u(!1)}};o.useEffect(()=>{j()},[]);const y=async r=>{try{const{bookmark_data:n}=r,{error:x}=await w.from("bookmark").insert([n]);if(x)throw x;const{error:b}=await w.from("bookmark_history").insert([{action:"restore",bookmark_id:n.id,bookmark_data:n,restored_from_id:r.id}]);if(b)throw b;i==null||i({type:"success",message:"ä¹¦ç­¾æ¢å¤æˆåŠŸ"}),m==null||m(),j()}catch(n){console.error("æ¢å¤ä¹¦ç­¾å¤±è´¥:",n),i==null||i({type:"error",message:"æ¢å¤ä¹¦ç­¾å¤±è´¥"})}};return e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"æ“ä½œå†å²"}),e.jsx("span",{className:"history-count",children:p?"åŠ è½½ä¸­...":`${d.length} æ¡è®°å½•`})]}),p?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½å†å²è®°å½•..."})]}):e.jsx("div",{className:"history-list",children:d.map(r=>e.jsxs("div",{className:"history-item",children:[e.jsxs("div",{className:"history-content",children:[e.jsxs("span",{className:"history-action",children:[r.action==="add"&&"æ·»åŠ äº†",r.action==="delete"&&"åˆ é™¤äº†",r.action==="update"&&"ä¿®æ”¹äº†",r.action==="restore"&&"æ¢å¤äº†"]}),e.jsx("span",{className:"history-name",children:r.bookmark_data.name}),e.jsx("span",{className:"history-time",children:J(new Date(r.created_at),{addSuffix:!0,locale:K})})]}),r.action==="delete"&&!g.has(r.id)&&e.jsx("button",{className:"restore-button",onClick:()=>y(r),children:"æ¢å¤"})]},r.id))})]})}function ae(){const[m,i]=o.useState(!0),{list:d,fetchBookmarks:c}=z();o.useEffect(()=>{(async()=>{i(!0),await c(),i(!1)})()},[]);const[p,u]=o.useState(!1),[g,h]=o.useState(null),j=t=>{navigator.clipboard.writeText(t).then(()=>{h({type:"success",message:"URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿"})}).catch(()=>{h({type:"error",message:"å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶"})})},y=async t=>{try{const l=Date.now()+Math.floor(Math.random()*1e3),L={...t,id:l,create_at:new Date().toISOString()},{error:$}=await w.from("bookmark").insert([L]).select();if($)throw $;await C("add",L),h({type:"success",message:"æˆåŠŸæ·»åŠ ä¹¦ç­¾"}),c()}catch(l){console.log(l),h({type:"error",message:"æ·»åŠ ä¹¦ç­¾å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"})}},r=async t=>{try{const{error:l}=await w.from("bookmark").delete().eq("url",t.url);if(l)throw l;await C("delete",t),h({type:"success",message:"æˆåŠŸåˆ é™¤ä¹¦ç­¾"}),c()}catch(l){console.error(l),h({type:"error",message:"åˆ é™¤ä¹¦ç­¾å¤±è´¥"})}},[n,x]=o.useState(!1),[b,k]=o.useState(null),D=t=>{k(t),x(!0)},q=async t=>{try{const{error:l}=await w.from("bookmark").update({name:t.name,category:t.category}).eq("url",t.url);if(l)throw l;await C("update",t),h({type:"success",message:"æˆåŠŸæ›´æ–°ä¹¦ç­¾"}),c()}catch(l){console.error(l),h({type:"error",message:"æ›´æ–°ä¹¦ç­¾å¤±è´¥"})}x(!1),k(null)},[N,S]=o.useState(!1),C=async(t,l)=>{try{await w.from("bookmark_history").insert([{action:t,bookmark_id:l.id,bookmark_data:l}])}catch(L){console.error("è®°å½•å†å²å¤±è´¥:",L)}};return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:`tab-button ${N?"":"active"}`,onClick:()=>S(!1),children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsx("button",{className:`tab-button ${N?"active":""}`,onClick:()=>S(!0),children:"æ“ä½œå†å²"})]}),e.jsx("div",{className:"dashboard-content",children:N?e.jsx(Y,{onRestore:c,onNotify:h}):e.jsxs("div",{className:"list-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{children:"ä¹¦ç­¾åˆ—è¡¨"}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{className:"add-button",onClick:()=>u(!0),children:[e.jsx("span",{className:"button-icon",children:"+"}),"æ·»åŠ ä¹¦ç­¾"]}),e.jsx("span",{className:"bookmark-count",children:m?"åŠ è½½ä¸­...":`${d.length} ä¸ªä¹¦ç­¾`})]})]}),m?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"æ­£åœ¨åŠ è½½ä¹¦ç­¾..."})]}):e.jsx("div",{className:"bookmark-list",children:d.map(t=>e.jsxs("div",{className:"bookmark-item",children:[e.jsx("div",{className:"bookmark-icon-wrapper",children:e.jsx("img",{src:t.icon,alt:"",className:"bookmark-icon",loading:"lazy",onError:l=>{l.target.src="/fallback-icon.svg"}})}),e.jsxs("div",{className:"bookmark-info",children:[e.jsx("h3",{children:t.name}),e.jsx("p",{className:"category-tag",children:t.category}),e.jsxs("div",{className:"url-container",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:t.url}),e.jsx("button",{className:"copy-button",onClick:l=>{l.preventDefault(),j(t.url)},title:"å¤åˆ¶URL",children:"ğŸ“‹"})]})]}),e.jsxs("div",{className:"bookmark-actions",children:[e.jsx("button",{className:"edit-button",onClick:()=>D(t),title:"ç¼–è¾‘ä¹¦ç­¾",children:"âœï¸"}),e.jsx("button",{className:"delete-button",onClick:()=>r(t),title:"åˆ é™¤ä¹¦ç­¾",children:e.jsx("span",{className:"delete-icon",children:"Ã—"})})]})]},t.url))})]})}),p&&e.jsx(Q,{onClose:()=>u(!1),onSubmit:y}),n&&b&&e.jsx(V,{bookmark:b,onClose:()=>{x(!1),k(null)},onSubmit:q}),g&&e.jsx(X,{type:g.type,message:g.message,onClose:()=>h(null)})]})}export{ae as default};
