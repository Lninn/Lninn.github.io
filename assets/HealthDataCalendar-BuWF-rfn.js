import{j as e}from"./index-CvC0IVlO.js";import{b as m}from"./vendor-D6FSTBK7.js";import{S as Y,R as I,C,a as b}from"./Col-CEOdXJqh.js";import{C as M}from"./index-CwPVaiTu.js";import{M as $}from"./index-Dj4wFS09.js";import"./utils-B-ph8sPT.js";const z=({color:t="currentColor",size:r="1em"})=>e.jsx("svg",{viewBox:"0 0 24 24",width:r,height:r,fill:t,children:e.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"})}),S=({color:t="currentColor",size:r="1em"})=>e.jsx("svg",{viewBox:"0 0 24 24",width:r,height:r,fill:t,children:e.jsx("path",{d:"M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"})}),H=({children:t,title:r,placement:l="top",delay:i=0})=>{const[j,c]=m.useState(!1),p=m.useRef(null),g=m.useRef(null),h=m.useRef(null),w=()=>{i>0?h.current=setTimeout(()=>{c(!0)},i):c(!0)},D=()=>{h.current&&clearTimeout(h.current),c(!1)};return m.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]),e.jsxs("div",{className:"tooltip-container",onMouseEnter:w,onMouseLeave:D,ref:g,children:[t,j&&e.jsx("div",{className:`tooltip tooltip-${l}`,ref:p,children:r})]})},V=(t,r)=>{if(t===0||r===0)return 0;const l=t/r;return l<=.25?1:l<=.5?2:l<=.75?3:4},F=(t,r="apple-health-data.json")=>{const l=JSON.stringify(t,null,2),i=new Blob([l],{type:"application/json"});E(i,r)},J=(t,r="apple-health-data.csv")=>{if(!t||!t.data||!Array.isArray(t.data))throw new Error("无效的数据格式");const l=t.activityTypes||[];let i="Date,RecordCount";l.forEach(c=>{i+=`,${c}`}),i+=`
`,t.data.forEach(c=>{i+=`${c.date},${c.count||0}`,l.forEach(p=>{const g=c.details&&c.details[p]?c.details[p]:0;i+=`,${g}`}),i+=`
`});const j=new Blob([i],{type:"text/csv;charset=utf-8;"});E(j,r)},E=(t,r)=>{const l=document.createElement("a");l.href=URL.createObjectURL(t),l.download=r,document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout(()=>{URL.revokeObjectURL(l.href)},100)},G=({data:t})=>{const[r,l]=m.useState("HKQuantityTypeIdentifierStepCount"),[i,j]=m.useState(window.innerWidth<=768);m.useEffect(()=>{const s=()=>{j(window.innerWidth<=768)};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const{calendarData:c,years:p,activityTypes:g,stats:h}=m.useMemo(()=>{if(!t||!t.data)return{calendarData:[],years:[],activityTypes:[],stats:{}};const s=[...new Set(t.data.map(n=>new Date(n.date).getFullYear()))].sort(),o={};s.forEach(n=>{o[n]=Array(53).fill().map(()=>Array(7).fill(null));const a=new Date(n,0,1),d=a.getDay(),f=new Date(n,11,31),y=Math.ceil((f-a)/(24*60*60*1e3))+1;for(let u=0;u<y;u++){const v=new Date(n,0,u+1),N=Math.floor((u+d)/7),L=v.getDay();o[n][N]&&(o[n][N][L]={date:v.toISOString().split("T")[0],count:0,details:{}})}}),t.data.forEach(n=>{const a=new Date(n.date),d=a.getFullYear(),f=new Date(d,0,1),y=f.getDay(),u=Math.floor((a-f)/(24*60*60*1e3)),v=Math.floor((u+y)/7),N=a.getDay();o[d]&&o[d][v]&&(o[d][v][N]={date:n.date,count:n.count,details:n.details})});const x={totalDays:t.data.length,totalActivities:t.data.reduce((n,a)=>n+a.count,0),maxDailyActivities:Math.max(...t.data.map(n=>n.count)),averageDailyActivities:Math.round(t.data.reduce((n,a)=>n+a.count,0)/t.data.length)};return{calendarData:o,years:s,activityTypes:["all",...t.activityTypes],stats:x}},[t]),w=s=>s?r==="all"?s.count:s.details[r]||0:0,D=m.useMemo(()=>{const s={};return p.forEach(o=>{let x=0;c[o].forEach(n=>{n.forEach(a=>{if(a){const d=w(a);d>x&&(x=d)}})}),s[o]=x}),s},[c,p,r]),T=()=>{const x=i?["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];return e.jsx("div",{className:"month-labels",children:x.map(n=>e.jsx("div",{className:"month-label",children:n},n))})},O=()=>{const s=["周日","周一","周二","周三","周四","周五","周六"];return e.jsx("div",{className:"weekday-labels",children:s.map(o=>e.jsx("div",{className:"weekday-label",children:o},o))})},R=s=>{const o=D[s];return e.jsxs("div",{className:"year-calendar",children:[e.jsxs("h3",{children:[s,"年"]}),e.jsxs("div",{className:"calendar-grid",children:[T(),e.jsxs("div",{className:"calendar-body",children:[O(),e.jsx("div",{className:"calendar-cells",children:c[s].map((x,n)=>e.jsx("div",{className:"calendar-week",children:x.map((a,d)=>{const f=w(a),y=V(f,o),u=a&&r==="StepCount"?a.details.StepCount||0:a&&a.stepCount||0;let v=a?`${a.date}: ${f} 活动`:"无数据";return a&&u>0&&(v=r==="StepCount"?`${a.date}: ${Math.round(u)} 步`:`${a.date}: ${f} 活动 (${Math.round(u)} 步)`),e.jsx(H,{title:v,placement:i?"top":"right",children:e.jsx("div",{className:`calendar-day intensity-${y}`,"data-date":a?a.date:""})},`${s}-w${n}-d${d}`)})},`${s}-w${n}`))})]})]})]},s)},k=()=>{try{F(t,`apple-health-data-${new Date().toISOString().split("T")[0]}.json`)}catch(s){$.error(`导出 JSON 失败: ${s.message}`)}},A=()=>{try{J(t,`apple-health-data-${new Date().toISOString().split("T")[0]}.csv`)}catch(s){$.error(`导出 CSV 失败: ${s.message}`)}};return e.jsxs("div",{className:"health-data-calendar",children:[e.jsxs("div",{className:"calendar-header",children:[e.jsx("div",{className:"calendar-title",children:e.jsx("h3",{children:"健康数据日历"})}),e.jsxs("div",{className:"calendar-actions",children:[e.jsx(Y,{value:r,onChange:l,options:[{value:"all",label:"所有活动"},...g.map(s=>({value:s,label:s}))]}),e.jsx("button",{className:"export-button",onClick:k,children:"导出 JSON"}),e.jsx("button",{className:"export-button",onClick:A,children:"导出 CSV"})]})]}),e.jsxs(I,{gutter:16,className:"stats-cards",children:[e.jsx(C,{span:i?12:6,xs:24,sm:12,md:6,children:e.jsx(M,{children:e.jsx(b,{title:"记录天数",value:h.totalDays,prefix:e.jsx(z,{}),suffix:"天"})})}),e.jsx(C,{span:i?12:6,xs:24,sm:12,md:6,children:e.jsx(M,{children:e.jsx(b,{title:"总活动数",value:h.totalActivities,prefix:e.jsx(S,{})})})}),e.jsx(C,{span:i?12:6,xs:24,sm:12,md:6,children:e.jsx(M,{children:e.jsx(b,{title:"单日最高活动",value:h.maxDailyActivities,prefix:e.jsx(S,{})})})}),e.jsx(C,{span:i?12:6,xs:24,sm:12,md:6,children:e.jsx(M,{children:e.jsx(b,{title:"日均活动",value:h.averageDailyActivities,prefix:e.jsx(S,{})})})})]}),e.jsxs("div",{className:"calendar-legend",children:[e.jsx("span",{children:"活动频率: "}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-0"}),e.jsx("span",{children:"无"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-1"}),e.jsx("span",{children:"低"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-2"}),e.jsx("span",{children:"中"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-3"}),e.jsx("span",{children:"高"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-color intensity-4"}),e.jsx("span",{children:"很高"})]})]})]}),p.map(s=>R(s))]})};export{G as default};
