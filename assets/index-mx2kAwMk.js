import{j as a,P as B,F as q,f as G,D as H,a as K,u as Q,d as V,t as W,c as X,b as Y}from"./index-C_QIXTce.js";import{b as d}from"./vendor-Bu9rO6sl.js";import{D as Z}from"./DraggableNavItem-D_D-UTMr.js";import{M as $}from"./index-CQE2wUto.js";import ee from"./DroppableNavList-C3OiCg_R.js";import ne from"./NavItemForm-Ti0aytfg.js";import"./utils-Pd6Wu3Vt.js";const le=()=>{const[f,p]=d.useState([]),[E,g]=d.useState(!0),[I,c]=d.useState(null),[v,h]=d.useState(!1),[O,x]=d.useState(null),[N,b]=d.useState("add"),[w,P]=d.useState([]),[_,D]=d.useState([]),m=async()=>{g(!0);try{const e=await G(!0);p(e)}catch(e){c(e.message)}finally{g(!1)}},A=async()=>{P(H),D(K)};d.useEffect(()=>{m(),A()},[]);const u=(e=null)=>{x({name:"",path:"",icon:"",component:"PlaceholderPage",parent_id:e,is_enabled:!0,order_index:f.length}),b("add"),h(!0)},F=e=>{x({...e}),b("edit"),h(!0)},M=async e=>{try{N==="add"?await X(e):await Y(e.id,e),h(!1),m()}catch(n){c(n.message)}},T=async e=>{if(window.confirm("确定要删除此导航项吗？"))try{await V(e),m()}catch(n){c(n.message),alert(n.message)}},L=async(e,n)=>{try{await W(e,!n),m()}catch(t){c(t.message)}},k=async e=>{const{destination:n,source:t,draggableId:r}=e;if(!n||n.droppableId===t.droppableId&&n.index===t.index)return;const s=r.replace("nav-item-",""),i=z(f,t,n,s);p(i);try{const l=C(i);await Q(l)}catch(l){c(l.message),m()}},z=(e,n,t,r)=>{if(n.droppableId===t.droppableId){const o=[...e],[J]=o.splice(n.index,1);return o.splice(t.index,0,J),o.forEach((R,U)=>{R.order_index=U}),o}const s=t.droppableId.replace("nav-list-",""),i=JSON.parse(JSON.stringify(e)),l=S(i,r);if(!l)return e;if(l.parent_id=s==="root"?null:parseInt(s),s==="root")i.splice(t.index,0,l);else{const o=j(i,parseInt(s));o&&(o.children||(o.children=[]),o.children.splice(t.index,0,l))}return y(i),i},S=(e,n)=>{const t=parseInt(n);for(let r=0;r<e.length;r++){if(e[r].id===t){const[s]=e.splice(r,1);return s}if(e[r].children&&e[r].children.length>0){const s=S(e[r].children,n);if(s)return s}}return null},j=(e,n)=>{for(const t of e){if(t.id===n)return t;if(t.children&&t.children.length>0){const r=j(t.children,n);if(r)return r}}return null},y=e=>{e.forEach((n,t)=>{n.order_index=t,n.children&&n.children.length>0&&y(n.children)})},C=(e,n=[])=>(e.forEach((t,r)=>{const s={id:t.id,order_index:r};n.push(s),t.children&&t.children.length>0&&C(t.children,n)}),n);return a.jsx(B,{children:a.jsxs("div",{className:"nav-config-page",children:[a.jsxs("div",{className:"nav-config-header",children:[a.jsx("h1",{children:"导航配置"}),a.jsxs("button",{className:"nav-config-add-btn",onClick:()=>u(),children:[a.jsx(q,{size:18}),"添加导航项"]})]}),I&&a.jsxs("div",{className:"nav-config-error",children:[I,a.jsx("button",{onClick:()=>c(null),children:"关闭"})]}),E?a.jsx("div",{className:"nav-config-loading",children:"加载中..."}):f.length===0?a.jsxs("div",{className:"nav-config-empty",children:[a.jsx("p",{children:"暂无导航项"}),a.jsx("button",{onClick:()=>u(),children:"添加导航项"})]}):a.jsx("div",{className:"nav-config-container",children:a.jsx(Z,{onDragEnd:k,children:a.jsx(ee,{items:f,droppableId:"root",onAddChild:u,onEdit:F,onToggleStatus:L,onDelete:T})})}),v&&a.jsx($,{isOpen:v,onClose:()=>h(!1),title:N==="add"?"添加导航项":"编辑导航项",size:"md",children:a.jsx(ne,{item:O,onSubmit:M,onCancel:()=>h(!1),availableIcons:w,availableComponents:_})})]})})};export{le as default};
