import{j as d}from"./index-zXCxgVst.js";import{b as c}from"./vendor-D6FSTBK7.js";import M from"./TimerHeader-mtyCFIHb.js";import F from"./ModeIndicator-BzPduiI0.js";import O from"./TimerDisplay-CjaaBaGh.js";import B from"./TimerControls-DZ4YzJ8E.js";import C from"./SettingsPanel-C4H3RqyJ.js";import L from"./TimerTips-C8_KhZ0w.js";import P from"./RecordsPanel-DCV_Zzcn.js";import A from"./GoalProgress-B6uJA2IB.js";import{M as b}from"./index-B5-axKcw.js";import"./utils-B-ph8sPT.js";import"./SettingsIcon-Ks6uWxC8.js";import"./RecordButton-BjxvG8F8.js";function J(a,m){const[u,w]=c.useState(!1),[o,S]=c.useState("focus"),[n,i]=c.useState(a.focusTime*60),[t,l]=c.useState({...a,soundOption:a.soundOption||"bell"}),[f,R]=c.useState(0),[r,g]=c.useState(null),[T,p]=c.useState(0),v=c.useRef(null);c.useEffect(()=>{const s={bell:"/sounds/bell.mp3",complete:"/sounds/complete.mp3",meditation:"/sounds/meditation-bell.mp3"};return v.current=new Audio(s[t.soundOption]),()=>{v.current&&(v.current.pause(),v.current=null)}},[t.soundOption]),c.useEffect(()=>{u&&o==="focus"&&!r&&g(new Date)},[u,o,r]),c.useEffect(()=>{let s=null;if(u&&n>0)s=setInterval(()=>{if(i(n-1),o==="focus"&&p(e=>e+1/60),n===30){const e=new Audio("/sounds/reminder.mp3");e.volume=t.volume||.5,e.play()}},1e3);else if(u&&n===0){if(v.current&&(v.current.volume=t.volume||1,v.current.play()),k){const e=o==="focus"?"专注时间结束！":o==="break"?"休息时间结束！":"长休息时间结束！",y=o==="focus"?"休息一下吧！":"准备开始新的专注时间";new Notification(e,{body:y,icon:"/favicon.ico"})}if(o==="focus"){const e=f+1;R(e),e%t.longBreakInterval===0?(S("longBreak"),i(t.longBreakTime*60)):(S("break"),i(t.breakTime*60))}else{if(m&&r){const e={focusTime:Math.round(T),cycles:f,mode:o,duration:Math.round((new Date-r)/1e3/60)};m(e),g(null),p(0)}S("focus"),i(t.focusTime*60)}}return()=>clearInterval(s)},[u,n,o,t,f,m,r,T]);const x=s=>{const e=Math.floor(s/60),y=s%60;return`${e.toString().padStart(2,"0")}:${y.toString().padStart(2,"0")}`},N=()=>{const s=o==="focus"?t.focusTime*60:o==="break"?t.breakTime*60:t.longBreakTime*60;return(s-n)/s*100},D=()=>{w(!u)},I=()=>{if(w(!1),i(o==="focus"?t.focusTime*60:o==="break"?t.breakTime*60:t.longBreakTime*60),r&&T>0&&m){const s={focusTime:Math.round(T),cycles:f,mode:o,duration:Math.round((new Date-r)/1e3/60)};m(s),g(null),p(0)}},j=s=>{l(s),i(o==="focus"?s.focusTime*60:o==="break"?s.breakTime*60:s.longBreakTime*60)},[k,h]=c.useState(!1);c.useEffect(()=>{"Notification"in window&&(Notification.permission==="granted"?h(!0):Notification.permission!=="denied"&&Notification.requestPermission().then(s=>{h(s==="granted")}))},[]),c.useEffect(()=>{let s=null;if(u&&n>0)s=setInterval(()=>{if(i(n-1),o==="focus"&&p(e=>e+1/60),n===30){const e=new Audio("/sounds/reminder.mp3");e.volume=t.volume||.5,e.play()}},1e3);else if(u&&n===0){if(v.current&&(v.current.volume=t.volume||1,v.current.play()),k){const e=o==="focus"?"专注时间结束！":o==="break"?"休息时间结束！":"长休息时间结束！",y=o==="focus"?"休息一下吧！":"准备开始新的专注时间";new Notification(e,{body:y,icon:"/favicon.ico"})}if(o==="focus"){const e=f+1;R(e),e%t.longBreakInterval===0?(S("longBreak"),i(t.longBreakTime*60)):(S("break"),i(t.breakTime*60))}else{if(m&&r){const e={focusTime:Math.round(T),cycles:f,mode:o,duration:Math.round((new Date-r)/1e3/60)};m(e),g(null),p(0)}S("focus"),i(t.focusTime*60)}}return()=>clearInterval(s)},[u,n,o,f,t,k]);const E=()=>{"Notification"in window&&Notification.permission!=="denied"&&Notification.requestPermission().then(s=>{h(s==="granted")})};return c.useEffect(()=>{const s=()=>{const y={mode:o,timeLeft:n,cycles:f,totalFocusTime:T,isRunning:!1,timestamp:new Date().toISOString()};localStorage.setItem("reading-timer-state",JSON.stringify(y))},e=setInterval(s,5e3);return window.addEventListener("beforeunload",s),()=>{clearInterval(e),window.removeEventListener("beforeunload",s)}},[o,n,f,T]),c.useEffect(()=>{const s=localStorage.getItem("reading-timer-state");if(s)try{const e=JSON.parse(s),y=new Date(e.timestamp);new Date-y<30*60*1e3?(S(e.mode),i(e.timeLeft),R(e.cycles),p(e.totalFocusTime)):localStorage.removeItem("reading-timer-state")}catch(e){console.error("恢复计时器状态失败",e),localStorage.removeItem("reading-timer-state")}},[]),{isRunning:u,mode:o,timeLeft:n,settings:t,cycles:f,totalFocusTime:T,formatTime:x,calculateProgress:N,toggleTimer:D,resetTimer:I,updateSettings:j,notificationsEnabled:k,requestNotificationPermission:E}}function q(){const[a,m]=c.useState(()=>{const n=localStorage.getItem("reading-timer-records");return n?JSON.parse(n):[]});return c.useEffect(()=>{localStorage.setItem("reading-timer-records",JSON.stringify(a))},[a]),{records:a,addRecord:n=>{const i={...n,id:Date.now(),timestamp:new Date().toISOString()};m(t=>[i,...t])},clearRecords:()=>{window.confirm("确定要清除所有阅读记录吗？此操作不可恢复。")&&m([])},deleteRecord:n=>{m(i=>i.filter(t=>t.id!==n))},getStats:()=>{if(a.length===0)return{totalFocusTime:0,totalSessions:0,totalCycles:0,averageFocusTime:0,lastWeekFocusTime:0,todayFocusTime:0};const n=a.reduce((r,g)=>r+(g.focusTime||0),0),i=new Date,t=new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime(),l=new Date(t-i.getDay()*864e5).getTime(),f=a.filter(r=>new Date(r.timestamp).getTime()>=t).reduce((r,g)=>r+(g.focusTime||0),0),R=a.filter(r=>new Date(r.timestamp).getTime()>=l).reduce((r,g)=>r+(g.focusTime||0),0);return{totalFocusTime:n,totalSessions:a.length,totalCycles:a.reduce((r,g)=>r+(g.cycles||0),0),averageFocusTime:Math.round(n/a.length),todayFocusTime:f,lastWeekFocusTime:R}}}}function se(){const[a,m]=c.useState(!1),[u,w]=c.useState(!1),{records:o,addRecord:S,clearRecords:n,deleteRecord:i,getStats:t}=q(),l=J({focusTime:25,breakTime:5,longBreakTime:15,longBreakInterval:4,soundOption:"bell",volume:1,dailyGoal:120},S),f=t(),R=()=>{m(!a),l.isRunning&&!a&&l.toggleTimer(),w(!1)},r=()=>{w(!u),m(!1)},g=T=>{l.updateSettings(T),m(!1)};return c.useEffect(()=>{const T=p=>{p.code==="Space"&&!a&&!u&&(p.preventDefault(),l.toggleTimer()),p.code==="KeyR"&&!a&&!u&&l.resetTimer(),p.code==="Escape"&&(a&&m(!1),u&&w(!1))};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[l,a,u]),d.jsxs("div",{className:"reading-timer-container",children:[d.jsxs("div",{className:"timer-layout",children:[d.jsx("div",{className:"timer-main",children:d.jsxs("div",{className:"timer-card",children:[d.jsx(M,{onSettingsClick:R,onRecordsClick:r}),d.jsx(F,{mode:l.mode,cycles:l.cycles}),d.jsx(O,{timeText:l.formatTime(l.timeLeft),progress:l.calculateProgress()}),d.jsx(B,{isRunning:l.isRunning,onToggle:l.toggleTimer,onReset:l.resetTimer})]})}),d.jsxs("div",{className:"timer-sidebar",children:[d.jsx(A,{current:f.todayFocusTime||0,goal:l.settings.dailyGoal}),d.jsx(L,{})]})]}),d.jsx(b,{isOpen:a,onClose:()=>m(!1),title:"计时器设置",size:"md",children:d.jsx(C,{settings:l.settings,onCancel:()=>m(!1),onApply:g})}),d.jsx(b,{isOpen:u,onClose:()=>w(!1),title:"阅读记录",size:"lg",children:d.jsx(P,{records:o,stats:f,onClear:n,onDelete:i,onClose:()=>w(!1)})}),d.jsx("div",{className:"keyboard-shortcuts",children:d.jsx("p",{children:"快捷键: 空格键 = 开始/暂停, R = 重置, ESC = 关闭面板"})})]})}export{se as default};
